<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        SwiftUI for Mac - Part 3 ::
        TrozWare
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="In part 1 of this series, I created a Mac app using SwiftUI. The app uses a Master-Detail design to list entries in an outline on the left and show details about the selected entry in the detail view on the right. In part 2 I explored using menus, adding all the expected user interface elements and opening secondary windows.
In this third and final part, I want to look at the various ways to present dialogs to the user.
"
/>
<meta name="keywords" content="[Swift Apple macOS iOS Apple Watch]" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://troz.net/post/2019/swiftui-for-mac-3/" />





 
<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="https://troz.net/style.css" />


<link rel="apple-touch-icon" sizes="180x180" href="/apple-touch-icon.png" />
<link rel="icon" type="image/png" sizes="32x32" href="/favicon-32x32.png" />
<link rel="icon" type="image/png" sizes="16x16" href="/favicon-16x16.png" />
<link rel="manifest" href="/site.webmanifest" />
<link rel="mask-icon" href="/safari-pinned-tab.svg" color="#5bbad5" />
<meta name="msapplication-TileColor" content="#da532c" />
<meta name="theme-color" content="#ffffff" />


<link href="/fonts/Inter-Italic.woff2"
rel="preload" type="font/woff2" as="font" crossorigin=""> <link href="/fonts/Inter-Regular.woff2" rel="preload"
type="font/woff2" as="font" crossorigin=""> <link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2"
as="font" crossorigin=""> <link href="/fonts/Inter-MediumItalic.woff2" rel="preload"
type="font/woff2" as="font" crossorigin=""> <link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2"
as="font" crossorigin=""> <link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2"
as="font" crossorigin="">


<meta property="og:url" content="https://troz.net/post/2019/swiftui-for-mac-3/">
  <meta property="og:site_name" content="TrozWare">
  <meta property="og:title" content="SwiftUI for Mac - Part 3">
  <meta property="og:description" content="Explorations in building a Mac app in Swift.">
  <meta property="og:locale" content="en">
  <meta property="og:type" content="article">
    <meta property="article:section" content="post">
    <meta property="article:published_time" content="2019-12-15T17:28:20+10:00">
    <meta property="article:modified_time" content="2019-12-15T17:28:20+10:00">
    <meta property="article:tag" content="Swift">
    <meta property="article:tag" content="Swiftui">
    <meta property="article:tag" content="Mac">






  </head>
  <body >
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="https://troz.net/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >TrozWare</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Home</a></li>
        
      
        
          <li><a href="/books/">Books</a></li>
        
      
        
          <li><a href="/apps/">Apps</a></li>
        
      
        
          <li><a href="/post/">Archives</a></li>
        
      
        
          <li><a href="/tags/">Tags</a></li>
        
      
        
          <li><a href="/contact/">Contact</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Home</a></li>
      
    
      
        <li><a href="/books/">Books</a></li>
      
    
      
        <li><a href="/apps/">Apps</a></li>
      
    
      
        <li><a href="/post/">Archives</a></li>
      
    
      
        <li><a href="/tags/">Tags</a></li>
      
    
      
        <li><a href="/contact/">Contact</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        

<link rel="stylesheet" href="/css/header.css" />

<div class="post">
  <h2 class="post-title">
    <a href="https://troz.net/post/2019/swiftui-for-mac-3/">SwiftUI for Mac - Part 3</a>
  </h2>
  <div class="post-meta">
    <span class="post-date">
      15 Dec 2019
    </span>
    <span class="more-meta">- 1873 words, </span>
    <span class="more-meta"> 9 minute read</span>
  </div>

  
  <span class="post-tags">
     #<a
      href="https://troz.net/tags/swift"
      >swift</a
    >&nbsp;  #<a
      href="https://troz.net/tags/swiftui"
      >swiftui</a
    >&nbsp;  #<a
      href="https://troz.net/tags/mac"
      >mac</a
    >&nbsp; 
  </span>
   

  <div class="post-content"><p>In <a href="/post/2019/swiftui-for-mac-1/">part 1 of this series</a>, I created a Mac app using SwiftUI. The app uses a Master-Detail design to list entries in an outline on the left and show details about the selected entry in the detail view on the right. In <a href="/post/2019/swiftui-for-mac-2/">part 2</a> I explored using menus, adding all the expected user interface elements and opening secondary windows.</p>
<p>In this third and final part, I want to look at the various ways to present dialogs to the user.</p>
<p>There are four different types of dialog that I want to explore:</p>
<ul>
<li>Alert</li>
<li>Action</li>
<li>Sheet</li>
<li>File dialogs (open &amp; save)</li>
</ul>
<p>So the first thing to do is add a footer to the DetailView to trigger each of these. I am going to separate this out into a new subview for neatness.</p>
<h2 id="alert">
  Alert
  <a href="#alert" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>To make an Alert, I need an @State Bool which sets whether the alert is visible or not. All the button has to do is toggle that Bool. Stripping out the extra code and views, this is what I have.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DialogsView</span>: View {
</span></span><span style="display:flex;"><span>    @State <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> alertIsShowing = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>    @State <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> dialogResult = <span style="color:#e6db74">&#34;Click the buttons above to test the dialogs.&#34;</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> body: some View {
</span></span><span style="display:flex;"><span>        Button(<span style="color:#e6db74">&#34;Alert&#34;</span>) { <span style="color:#66d9ef">self</span>.alertIsShowing.toggle() }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>To configure the alert itself, I added an alert modifier to the outmost view in this view. The <code>dialogResult</code> string is a diagnostic that I can use to confirm that the results of the various dialogs get passed back to the parent view.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  Alert(title: Text(<span style="color:#e6db74">&#34;Alert&#34;</span>),
</span></span><span style="display:flex;"><span>        message: Text(<span style="color:#e6db74">&#34;This is an alert!&#34;</span>),
</span></span><span style="display:flex;"><span>        dismissButton: .<span style="color:#66d9ef">default</span>(Text(<span style="color:#e6db74">&#34;OK&#34;</span>)) {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">self</span>.dialogResult = <span style="color:#e6db74">&#34;OK clicked in Alert&#34;</span>
</span></span><span style="display:flex;"><span>      })
</span></span></code></pre></div><p>There were a few things that tripped me up in this relatively short chunk of code. Firstly, both title and message must be Text views, not strings. If you get an error message that says &ldquo;Cannot convert value of type &lsquo;String&rsquo; to expected argument type &lsquo;Text&rsquo;&rdquo;, then you have forgotten to use a Text view.</p>
<p>Then there is the button which auto-suggest tells me is of type Alert.Button. I couldn&rsquo;t find any documentation for this, but delving into the definition for Alert, I see that there are three pre-defined button types: default, cancel or destructive. Cancel actually has two variants and will use a label appropriate to the user&rsquo;s locale if no label is supplied.</p>
<p>Again, these buttons need a Text view as the label (if supplied) and can take an action closure, which I used to update my <code>dialogResult</code> string.</p>
<p>This version showed a single <code>dismissButton</code> but I saw that there was a variation of Alert with <code>primary</code> and <code>secondary</code> buttons. It was not obvious that these would also dismiss the alert dialog, but I tried anyway.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  Alert(title: Text(<span style="color:#e6db74">&#34;Alert&#34;</span>),
</span></span><span style="display:flex;"><span>        message: Text(<span style="color:#e6db74">&#34;This is an alert!&#34;</span>),
</span></span><span style="display:flex;"><span>        primaryButton: .<span style="color:#66d9ef">default</span>(Text(<span style="color:#e6db74">&#34;OK&#34;</span>), action: {
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">self</span>.dialogResult = <span style="color:#e6db74">&#34;OK clicked in Alert&#34;</span>
</span></span><span style="display:flex;"><span>        }), secondaryButton: .cancel({
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">self</span>.dialogResult = <span style="color:#e6db74">&#34;Cancel clicked in Alert&#34;</span>
</span></span><span style="display:flex;"><span>        }))
</span></span></code></pre></div><p>This worked very nicely and the Esc and Return keys triggered the two buttons as you would expect with both of them closing the dialog.</p>
<p><img src="/images/SwiftUI-Mac-alert.jpg" alt="Alert"></p>
<p>I tried using the <code>destructive</code> button type, but there was no difference to either the appearance or behavior of the button.</p>
<p>So Alert is a great choice for a text-based dialog, either for informational use or to allow two choices of action.</p>
<h2 id="action">
  Action
  <a href="#action" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Very short section here - &lsquo;ActionSheet&rsquo; is unavailable in macOS! I probably should have researched that before I started this section. So use Alerts, I guess or a custom sheet.</p>
<h2 id="sheets">
  Sheets
  <a href="#sheets" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>While Alerts have a very fixed structure, sheets allow us to put any SwiftUI view into a sheet dialog.</p>
<p>So I added another Bool for the Sheet button to toggle, and added this sheet modifier. SheetView right now is simply a TextView.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  .sheet(isPresented: <span style="color:#960050;background-color:#1e0010">$</span>sheetIsShowing) {
</span></span><span style="display:flex;"><span>      SheetView()
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>This didn&rsquo;t work so well. It showed the sheet, but the sheet was tiny - only the size of the Text view it contained. And I had no way of dismissing it&hellip;</p>
<p>The size problem was solved by setting a frame on the Text view in SheetView.</p>
<p>The trick to dismissing the sheet is to pass it a Binding to the Bool that triggered it to open in the first place. If a button in the sheet sets this Bool back to false, the parent view will hide the sheet. That sounds confusing, but it works.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  .sheet(isPresented: <span style="color:#960050;background-color:#1e0010">$</span>sheetIsShowing) {
</span></span><span style="display:flex;"><span>      SheetView(isVisible: <span style="color:#66d9ef">self</span>.<span style="color:#960050;background-color:#1e0010">$</span>sheetIsShowing)
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">SheetView</span>: View {
</span></span><span style="display:flex;"><span>    @Binding <span style="color:#66d9ef">var</span> isVisible: Bool
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> body: some View {
</span></span><span style="display:flex;"><span>        VStack {
</span></span><span style="display:flex;"><span>            Text(<span style="color:#e6db74">&#34;This is a sheet.&#34;</span>)
</span></span><span style="display:flex;"><span>            Button(<span style="color:#e6db74">&#34;OK&#34;</span>) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">self</span>.isVisible = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        .frame(width: <span style="color:#ae81ff">300</span>, height: <span style="color:#ae81ff">150</span>)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Here is a very bad diagram that tries to explain what is happening:</p>
<p><img src="/images/SwiftUI-Mac-sheet.png" alt="Sheet"></p>
<p>The parent view has an @State Boolean variable called <code>sheetIsShowing</code>. This is bound to the alert&rsquo;s <code>isPresented</code> so it dictates whenever the sheet is visible. When the Sheet button is clicked, this variable is set to <code>true</code> and the sheet opens. But at the same time, a Binding to this variable is passed to the sheet. I deliberately gave this a different name, so as to make it clear which View was changing what variable.</p>
<p>When the sheet wants to close, it does not close itself. Instead it sets this variable to false. Because it is a Binding, this sets the original <code>sheetIsShowing</code> variable on the parent view to false and the parent view then closes the sheet.</p>
<p><strong>UPDATE:</strong> Look at <strong><a href="/post/2020/swiftui_for-mac-extras#dismissing-sheets">Dismissing sheets</a></strong> in my post of extras &amp; changes to this series for an alternative way to dismiss a sheet.</p>
<h3 id="sheets--data">
  Sheets &amp; Data
  <a href="#sheets--data" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>With this in place, I had the sheet opening and closing perfectly, but I was not yet passing data back &amp; forth between the sheet and its parent view. I decide to put a TextField in the SheetView and bind its contents to the <code>dialogResult</code> property in the DetailView so that any edits appeared immediately in the DetailView. And while I am there, I might as well add some more decorations to the SheetView since it is a full View and not a restricted Alert.</p>
<p>Calling the SheetView changed to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  .sheet(isPresented: <span style="color:#960050;background-color:#1e0010">$</span>sheetIsShowing) {
</span></span><span style="display:flex;"><span>      SheetView(isVisible: <span style="color:#66d9ef">self</span>.<span style="color:#960050;background-color:#1e0010">$</span>sheetIsShowing, enteredText: <span style="color:#66d9ef">self</span>.<span style="color:#960050;background-color:#1e0010">$</span>dialogResult)
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>And the SheetView itself (not all the interface is listed here for brevity):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">SheetView</span>: View {
</span></span><span style="display:flex;"><span>    @Binding <span style="color:#66d9ef">var</span> isVisible: Bool
</span></span><span style="display:flex;"><span>    @Binding <span style="color:#66d9ef">var</span> enteredText: String
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> body: some View {
</span></span><span style="display:flex;"><span>        VStack {
</span></span><span style="display:flex;"><span>            Text(<span style="color:#e6db74">&#34;Enter some text below…&#34;</span>)
</span></span><span style="display:flex;"><span>                .font(.headline)
</span></span><span style="display:flex;"><span>                .multilineTextAlignment(.center)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            TextField(<span style="color:#e6db74">&#34;Enter the result of the dialog here…&#34;</span>, text: <span style="color:#960050;background-color:#1e0010">$</span>enteredText)
</span></span><span style="display:flex;"><span>                 .padding()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            HStack {
</span></span><span style="display:flex;"><span>                Button(<span style="color:#e6db74">&#34;Cancel&#34;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">self</span>.isVisible = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">self</span>.enteredText = <span style="color:#e6db74">&#34;Cancel clicked in Sheet&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                Spacer()
</span></span><span style="display:flex;"><span>                Button(<span style="color:#e6db74">&#34;OK&#34;</span>) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">self</span>.isVisible = <span style="color:#66d9ef">false</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">self</span>.enteredText = <span style="color:#e6db74">&#34;OK: </span><span style="color:#e6db74">\(</span><span style="color:#66d9ef">self</span>.enteredText<span style="color:#e6db74">)</span><span style="color:#e6db74">&#34;</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        .frame(width: <span style="color:#ae81ff">300</span>, height: <span style="color:#ae81ff">200</span>)
</span></span><span style="display:flex;"><span>        .padding()
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><img src="/images/SwiftUI-Mac-sheet-data.png" alt="Sheet with data"></p>
<p>I only had two issues with this now. I was not able to get the focus into the TextField automatically when the sheet opened and I was not able to assign keyboard shortcuts to the Cancel and OK buttons so that they could be operated without a mouse. And as I mentioned in the previous part, I was not able to make the OK button take on the default styling.</p>
<p>One useful technique that I developed: the SheetView is in the DialogsView.swift file instead of in its own SwiftUI file. It would probably be a good idea to separate it out but I didn&rsquo;t which meant that it had no Canvas preview to look at while I was laying it out.</p>
<p>So I edited the PreviewProvider like this, so that I could change the comments to switch it between showing the DialogsView and showing the SheetView.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">DialogsView_Previews</span>: PreviewProvider {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">static</span> <span style="color:#66d9ef">var</span> previews: some View {
</span></span><span style="display:flex;"><span>        <span style="color:#75715e">// DialogsView()</span>
</span></span><span style="display:flex;"><span>        SheetView(isVisible: .constant(<span style="color:#66d9ef">true</span>), enteredText: .constant(<span style="color:#e6db74">&#34;&#34;</span>))
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="files">
  Files
  <a href="#files" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>AppKit provides NSOpenPanel for selecting a file and NSSavePanel for saving. I will try to implement NSSavePanel to allow saving the current cat image.</p>
<p>Since this is an AppKit control rather than a SwiftUI control, I assumed that I would need to use NSViewRepresentable like I did for the NSColorWell in part 2. But while NSColorWell is a descendent of NSView, NSSavePanel is not. So I need a new idea.</p>
<p>Rather naively, I thought maybe I could just create an NSSavePanel in a function inside DialogsView and see what happened.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  <span style="color:#66d9ef">func</span> <span style="color:#a6e22e">saveImage</span>() {
</span></span><span style="display:flex;"><span>      <span style="color:#66d9ef">let</span> panel = NSSavePanel()
</span></span><span style="display:flex;"><span>      panel.nameFieldLabel = <span style="color:#e6db74">&#34;Save cat image as:&#34;</span>
</span></span><span style="display:flex;"><span>      panel.nameFieldStringValue = <span style="color:#e6db74">&#34;cat.jpg&#34;</span>
</span></span><span style="display:flex;"><span>      panel.canCreateDirectories = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>      panel.begin { response <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>          <span style="color:#66d9ef">if</span> response == NSApplication.ModalResponse.OK, <span style="color:#66d9ef">let</span> fileUrl = panel.url {
</span></span><span style="display:flex;"><span>              print(fileUrl)
</span></span><span style="display:flex;"><span>          }
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>  }
</span></span></code></pre></div><p>Crash &amp; burn&hellip; so what if I made the NSSavePanel an @State property of the View? No, that crashed even faster. Maybe SwiftUI Views don&rsquo;t like this sort of thing, but how about if I get the Application Delegate to handle it? What if I moved the <code>saveImage</code> method to the App Delegate and changed the calling function to access it there?</p>
<p>Still crashed. At this stage I am beginning to wonder if I know how to use an NSSavePanel. Time to create a simple test app without SwiftUI and see what happens. Well it appears that I no longer know how to use an NSSavePanel. Code from an older project that works fine, will not work in my new sample project!</p>
<p>Guess what - it was another macOS Catalina security issue which I would have realised faster I had opened the Console. Back to the Signing &amp; Capabilities section of the target settings and this time I set File Access for User Selected File to Read/Write.</p>
<p>Now the NSSavePanel opens when called from DialogsView and prints the selected file URL if one is chosen.</p>
<p>But this is all happening in DialogsView, which is a subview of DetailView. And DetailView is the view that holds the image, not DialogsView. So how can I save the image? Do I pass the URL to DetailView or pass the image to DialogsView? Or do something clever with Notifications and Subscriptions?</p>
<p>I really don&rsquo;t know what is best, but I have decided to post a Notification with the URL as its object. DetailView can receive this Notification and save the image whenever it is received.</p>
<p>So I replaced the <code>print</code> line in the <code>saveImage()</code> method with:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>  NotificationCenter.<span style="color:#66d9ef">default</span>.post(name: .saveImage, object: fileUrl)
</span></span></code></pre></div><p>And in DetailView, I set up the publisher:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>    <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">let</span> saveImageUrlSelected = NotificationCenter.<span style="color:#66d9ef">default</span>
</span></span><span style="display:flex;"><span>         .publisher(<span style="color:#66d9ef">for</span>: .saveImage)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">var</span> body: some View {
</span></span><span style="display:flex;"><span>        VStack {
</span></span><span style="display:flex;"><span>          <span style="color:#75715e">// view code removed for brevity</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        .onReceive(saveImageUrlSelected) { publisher <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> saveUrl = publisher.object <span style="color:#66d9ef">as</span>? URL,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> imageData = <span style="color:#66d9ef">self</span>.catImage?.tiffRepresentation {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> imageRep = NSBitmapImageRep(data: imageData) {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> saveData = imageRep.representation(using: .jpeg,
</span></span><span style="display:flex;"><span>                                                              properties: [:]) {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">try</span>? saveData.write(to: saveUrl)
</span></span><span style="display:flex;"><span>                    }
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span></code></pre></div><p>And there we have it. Three types of dialogs demonstrated in a SwiftUI for Mac app:</p>
<ol>
<li>Alerts: good for simply text-only dialogs</li>
<li>Sheets: good for more complex dialogs</li>
<li>Panels: AppKit dialogs that can be called from a SwiftUI View.</li>
</ol>
<p>I think this time I really am finished. This article has already expanded out into a 3-part monster, so I think it is way past time that I stopped typing. I hope you have enjoyed this series. Please use any of the buttons below to contact me or use the <a href="/contact/">Contact page</a> on this site. I would love to hear from anyone who found this series useful or who had any suggestions or corrections to make.</p>
<p>The final project is available on <a href="https://github.com/trozware/swiftui-mac">GitHub</a> if you would like to download it and take a look.</p></div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <a class="btn next" href="https://troz.net/post/2020/swiftui_for-mac-extras/"
        >← SwiftUI for Mac Extras</a
      >
       
      <a class="btn previous" href="https://troz.net/post/2019/swiftui-for-mac-2/"
        >SwiftUI for Mac - Part 2 →</a
      >
      
    </div>
  </div>
  
</div>

      </div>

      
        <link rel="stylesheet" href="/css/footer.css" />

<footer class="footer">
  <div class="footer__inner">
    <div class="social_footer">
      <a
        id="email-Link"
        class="mailtoui"
        href="mailto:sarah@troz.net"
        aria-label="Email me"
        ><img src="/icons/envelope.svg" alt=""
      /></a>
      
      <a
        rel="me"
        href="https://mastodon.social/@troz"
        aria-label="Follow me on Mastodon"
        ><img src="/icons/mastodon.png" alt=""
      /></a>

      <a href="https://linktr.ee/trozware" aria-label="Check out all my links"
        ><img src="/icons/tree.svg" alt=""
      /></a>

      <a
        href="https://github.com/trozware"
        aria-label="Look at my code on Github"
        ><img src="/icons/github.svg" alt=""
      /></a>

      <a
        href="https://stackoverflow.com/users/1082632"
        aria-label="Check out my Stack Overflow profile"
        ><img src="/icons/stack-overflow.svg" alt=""
      /></a>

      <a href="https://troz.net/index.xml" aria-label="Subscribe to my RSS feed"
        ><img src="/icons/rss.svg" alt=""
      /></a>
      <a
        href="https://troz.net/feed.json"
        aria-label="Subscribe to my JSON feed"
        ><img src="/icons/json.png" alt=""
      /></a>

      <a href="https://dev.to/trozware" aria-label="Check out my DEV profile">
        <img
          src="/icons/dev-badge.svg"
          alt=""
          alt="TrozWare's DEV Profile"
          style="height: 37px; margin-top: -3px"
          height="40"
          width="40"
        />
      </a>

      <a
        href="https://ko-fi.com/H2H3BU7SI"
        target="_blank"
        aria-label="Buy me a coffee"
        ><img
          height="36"
          style="border: 0px; height: 36px; width: unset"
          src="https://cdn.ko-fi.com/cdn/kofi1.png?v=3"
          border="0"
          alt="Buy Me a Coffee at ko-fi.com"
      /></a>
    </div>
  </div>

  <div class="footer__inner">
    <div class="copyright">
      
      <span>© 2012 - 2024 Sarah Reichelt</span>
      
      <span
        ><a href="http://gohugo.io">Hugo</a> theme created by
        <a href="https://twitter.com/panr">panr</a> 2018</span
      >
    </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


<script src="https://cdn.jsdelivr.net/npm/mailtoui@latest/dist/mailtoui-min.js"></script>



<script src="/quicklink.js"></script>

<script>
  window.addEventListener('load', () => {
    quicklink()
  })
</script>


      
    </div>

    
  </body>
</html>

<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        JSON Parsing in Swift 4 ::
        TrozWare
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="Updated: 3rd September 2017.
Checked syntax using Xcode 9.0 beta 6. Added section on allowing for nulls. Since JSON has become the de facto standard for data transfers around the internet, there has always been a lot of interest in Swift libraries to parse JSON into Swift classes or structs. Searching for &amp;ldquo;swift json library&amp;rdquo; on GitHub discovers 77 86 repositories. So why are there so many? And what has Swift 4 done to sherlock them all?
"
/>
<meta name="keywords" content="[Swift Apple macOS iOS Apple Watch]" />
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://troz.net/post/2017/json-parsing-in-swift-4/" />





 
<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="https://troz.net/style.css" />


<link
  rel="apple-touch-icon"
  sizes="180x180"
  href="/static/favs/apple-touch-icon.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="32x32"
  href="/static/favs/favicon-32x32.png"
/>
<link
  rel="icon"
  type="image/png"
  sizes="16x16"
  href="/static/favs/favicon-16x16.png"
/>
<link
  rel="manifest"
  href="/static/favs/site.webmanifest"
  crossorigin="use-credentials"
/>
<link
  rel="mask-icon"
  href="/static/favs/safari-pinned-tab.svg"
  color="#5bbad5"
/>
<link rel="shortcut icon" href="/static/favs/favicon.ico" />
<meta name="msapplication-TileColor" content="#da532c" />
<meta name="msapplication-config" content="/static/favs/browserconfig.xml" />
<meta name="theme-color" content="#ffffff" />


<link href="/fonts/Inter-Italic.woff2"
rel="preload" type="font/woff2" as="font" crossorigin=""> <link href="/fonts/Inter-Regular.woff2" rel="preload"
type="font/woff2" as="font" crossorigin=""> <link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2"
as="font" crossorigin=""> <link href="/fonts/Inter-MediumItalic.woff2" rel="preload"
type="font/woff2" as="font" crossorigin=""> <link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2"
as="font" crossorigin=""> <link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2"
as="font" crossorigin="">


<meta property="og:title" content="JSON Parsing in Swift 4" />
<meta property="og:description" content="Updated: 3rd September 2017.

Checked syntax using Xcode 9.0 beta 6.
Added section on allowing for nulls.


Since JSON has become the de facto standard for data transfers around the
internet, there has always been a lot of interest in Swift libraries to parse
JSON into Swift classes or structs. Searching for &ldquo;swift json library&rdquo; on
GitHub discovers 77 86 repositories. So why are there so many? And
what has Swift 4 done to sherlock them all?" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://troz.net/post/2017/json-parsing-in-swift-4/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2017-06-18T00:00:00+00:00" />
<meta property="article:modified_time" content="2017-06-18T00:00:00+00:00" />






  </head>
  <body >
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="https://troz.net/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >TrozWare</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Home</a></li>
        
      
        
          <li><a href="/apps/">Apps</a></li>
        
      
        
          <li><a href="/post/">Archives</a></li>
        
      
        
          <li><a href="/tags/">Tags</a></li>
        
      
        
          <li><a href="/contact/">Contact</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Home</a></li>
      
    
      
        <li><a href="/apps/">Apps</a></li>
      
    
      
        <li><a href="/post/">Archives</a></li>
      
    
      
        <li><a href="/tags/">Tags</a></li>
      
    
      
        <li><a href="/contact/">Contact</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        

<link rel="stylesheet" href="/css/header.css" />

<div class="post">
  <h2 class="post-title">
    <a href="https://troz.net/post/2017/json-parsing-in-swift-4/">JSON Parsing in Swift 4</a>
  </h2>
  <div class="post-meta">
    <span class="post-date">
      18 Jun 2017
    </span>
    <span class="more-meta">- 2692 words, </span>
    <span class="more-meta"> 13 minute read</span>
  </div>

  
  <span class="post-tags">
     #<a
      href="https://troz.net/tags/swift"
      >swift</a
    >&nbsp;  #<a
      href="https://troz.net/tags/json"
      >json</a
    >&nbsp;  #<a
      href="https://troz.net/tags/learning-swift"
      >learning swift</a
    >&nbsp; 
  </span>
   

  <div class="post-content"><p><strong>Updated:</strong> 3rd September 2017.</p>
<ul>
<li>Checked syntax using Xcode 9.0 beta 6.</li>
<li>Added section on <a href="#nulls">allowing for nulls</a>.</li>
</ul>
<hr>
<p>Since <strong>JSON</strong> has become the de facto standard for data transfers around the
internet, there has always been a lot of interest in Swift libraries to parse
JSON into Swift classes or structs. Searching for &ldquo;swift json library&rdquo; on
<a href="https://github.com/search?q=swift+json+library">GitHub</a> discovers <!-- raw HTML omitted -->77<!-- raw HTML omitted --> 86 repositories. So why are there so many? And
what has Swift 4 done to <em>sherlock</em> them all?</p>
<p>The problem has always been converting loosely typed JSON to strictly typed
Swift which involves a lot of type casting, checking, optionals etc. Swift has
always provided access to the Objective-C methods for converting JSON to and
from NSData, NSDictionary and NSArray. (These are now called Data, Dictionary
and Array, but those labels are so universal, that I sometimes feel a more
specific nomenclature would be useful. Have you tried doing a search for
&lsquo;Data&rsquo;?)</p>
<p>For sample data, I am using <a href="https://jsonplaceholder.typicode.com/users">https://jsonplaceholder.typicode.com/users</a> which
returns 10 user objects in this format:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-json" data-lang="json"><span style="display:flex;"><span>{
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;id&#34;</span>: <span style="color:#ae81ff">1</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Leanne Graham&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;username&#34;</span>: <span style="color:#e6db74">&#34;Bret&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;email&#34;</span>: <span style="color:#e6db74">&#34;Sincere@april.biz&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;address&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;street&#34;</span>: <span style="color:#e6db74">&#34;Kulas Light&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;suite&#34;</span>: <span style="color:#e6db74">&#34;Apt. 556&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;city&#34;</span>: <span style="color:#e6db74">&#34;Gwenborough&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;zipcode&#34;</span>: <span style="color:#e6db74">&#34;92998-3874&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;geo&#34;</span>: {
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;lat&#34;</span>: <span style="color:#e6db74">&#34;-37.3159&#34;</span>,
</span></span><span style="display:flex;"><span>      <span style="color:#f92672">&#34;lng&#34;</span>: <span style="color:#e6db74">&#34;81.1496&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  },
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;phone&#34;</span>: <span style="color:#e6db74">&#34;1-770-736-8031 x56442&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;website&#34;</span>: <span style="color:#e6db74">&#34;hildegard.org&#34;</span>,
</span></span><span style="display:flex;"><span>  <span style="color:#f92672">&#34;company&#34;</span>: {
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;name&#34;</span>: <span style="color:#e6db74">&#34;Romaguera-Crona&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;catchPhrase&#34;</span>: <span style="color:#e6db74">&#34;Multi-layered client-server neural-net&#34;</span>,
</span></span><span style="display:flex;"><span>    <span style="color:#f92672">&#34;bs&#34;</span>: <span style="color:#e6db74">&#34;harness real-time e-markets&#34;</span>
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The goal will be to convert this to an instance of this matching Swift struct:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">User</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> id: Int
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> username: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> email: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> phone: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> website: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> address: Address
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> company: Company
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Address</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> street: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> suite: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> city: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> zipcode: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> geo: Coordinates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Coordinates</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lat: Double
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lng: Double
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Company</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> catchPhrase: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> bs: String
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The first thing to note is that the Swift struct (and its embedded structs) use
multiple different types: Int, String, Double, Address, Coordinates, Company.
The JSON data only has strings and numbers and even then, some of the numbers
are really strings - look at the lat &amp; lng entries. So converting from JSON to a
struct and back again has always been problematic, but let&rsquo;s give it a go using
built-in Swift 3 processing with no external libraries.</p>
<h2 id="decoding-in-swift-3">
  Decoding in Swift 3
  <a href="#decoding-in-swift-3" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>You can insert this into a playground or <a href="https://github.com/trozware/json">download my playground</a> and check
out the Swift 3 JSON page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Foundation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> sampleDataAddress = <span style="color:#e6db74">&#34;https://jsonplaceholder.typicode.com/users&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> url = URL(string: sampleDataAddress)<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonData = <span style="color:#66d9ef">try</span>! Data(contentsOf: url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">User</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> id: Int
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> username: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> email: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> phone: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> website: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> address: Address
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> company: Company
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">init</span>?(dict: [String: Any]) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">guard</span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> id = dict[<span style="color:#e6db74">&#34;id&#34;</span>] <span style="color:#66d9ef">as</span>? Int,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> name = dict[<span style="color:#e6db74">&#34;name&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> username = dict[<span style="color:#e6db74">&#34;username&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> email = dict[<span style="color:#e6db74">&#34;email&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> phone = dict[<span style="color:#e6db74">&#34;phone&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> website = dict[<span style="color:#e6db74">&#34;website&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> addressDict = dict[<span style="color:#e6db74">&#34;address&#34;</span>] <span style="color:#66d9ef">as</span>? [String: Any],
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> address = Address(dict: addressDict),
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> companyDict = dict[<span style="color:#e6db74">&#34;company&#34;</span>] <span style="color:#66d9ef">as</span>? [String: Any],
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> company = Company(dict: companyDict)
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.id = id
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.name = name
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.username = username
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.email = email
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.phone = phone
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.website = website
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.address = address
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">self</span>.company = company
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Address</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> street: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> suite: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> city: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> zipcode: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> geo: Coordinates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">init</span>?(dict: [String: Any]) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">guard</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> street = dict[<span style="color:#e6db74">&#34;street&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> suite = dict[<span style="color:#e6db74">&#34;suite&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> city = dict[<span style="color:#e6db74">&#34;city&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> zipcode = dict[<span style="color:#e6db74">&#34;zipcode&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> geoDict = dict[<span style="color:#e6db74">&#34;geo&#34;</span>] <span style="color:#66d9ef">as</span>? [String: Any],
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> geo = Coordinates(dict: geoDict) <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.street = street
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.suite = suite
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.city = city
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.zipcode = zipcode
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.geo = geo
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Coordinates</span> {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lat: Double
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lng: Double
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">init</span>?(dict: [String: Any]) {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">guard</span>
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">let</span> latString = dict[<span style="color:#e6db74">&#34;lat&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">let</span> lat = Double(latString),
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">let</span> lngString = dict[<span style="color:#e6db74">&#34;lng&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">let</span> lng = Double(lngString) <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                        <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>                }
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">self</span>.lat = lat
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">self</span>.lng = lng
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Company</span> {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> catchPhrase: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> bs: String
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">init</span>?(dict: [String: Any]) {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">guard</span>
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> name = dict[<span style="color:#e6db74">&#34;name&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> catchPhrase = dict[<span style="color:#e6db74">&#34;catchPhrase&#34;</span>] <span style="color:#66d9ef">as</span>? String,
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> bs = dict[<span style="color:#e6db74">&#34;bs&#34;</span>] <span style="color:#66d9ef">as</span>? String <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>                    <span style="color:#66d9ef">return</span> <span style="color:#66d9ef">nil</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.name = name
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.catchPhrase = catchPhrase
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">self</span>.bs = bs
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> json = <span style="color:#66d9ef">try</span>? JSONSerialization.jsonObject(with: jsonData, options: []) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> jsonArray = json <span style="color:#66d9ef">as</span>? [[String: Any]] {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> users = jsonArray.flatMap {
</span></span><span style="display:flex;"><span>            User(dict: $0)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>        users.count
</span></span><span style="display:flex;"><span>        dump(users.first)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I don&rsquo;t actually expect you to go through all this code in detail, but I
included it here to make it obvious how verbose this method is.</p>
<p>The first 3 lines get the data, and I have force-unwrapped the URL and the Data
which I would not do in a production app but which is OK while testing in a
playground. Then there is a declaration of the Users struct with all its sub
structs. Each one has a failable init that tries to parse the JSON dictionary
and returns nil if the data doesn&rsquo;t match, by way of a lengthy set of guard
statements. The basic layout of each struct is the same but it is very verbose.
And as an extra step, the lat and lng properties need to be converted from
Strings to Doubles.</p>
<p>I have to confess that it took quite come time to get this right &hellip; lots of
guard statements to check that the data can be converted to the required types
which meant that any typos produced an empty array. The sub-structs have to be
extracted from the JSON as Dictionaries and then initialised by themselves.</p>
<h2 id="decoding-in-swift-4">
  Decoding in Swift 4
  <a href="#decoding-in-swift-4" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>So this works, and I get an array of Users objects. But it isn&rsquo;t pretty and it
takes a lot of code to do the processing. So now I am going to move on to doing
this in Swift 4. I am using Xcode 9.0 beta 6 (9M214v) so if you have a later
version, you may need to adapt to any changes.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">User</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> id: Int
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> username: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> email: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> phone: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> website: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> address: Address
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> company: Company
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Address</span>: Codable {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> street: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> suite: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> city: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> zipcode: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> geo: Coordinates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Coordinates</span>: Codable {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lat: String
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lng: String
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Company</span>: Codable {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> catchPhrase: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> bs: String
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonDecoder = JSONDecoder()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> users = <span style="color:#66d9ef">try</span>? jsonDecoder.decode(Array&lt;User&gt;.<span style="color:#66d9ef">self</span>,
</span></span><span style="display:flex;"><span>                                    from: jsonData)
</span></span></code></pre></div><p>Ignoring the complexities of converting latitude and longitude to Doubles, I get
vastly simpler code. I declare all the structs as conforming to the <code>Codable</code>
protocol and then I can remove all the init methods and just let <code>JSONDecoder</code>
do its magic. I just have to tell it what data type to expect - in this case an
Array of Users. I don&rsquo;t have to worry about the initial conversion of the JSON
data to a Dictionary or looping through the elements using flatMap.</p>
<p><em>In the playground, I used a do&hellip;catch structure to check the result of the
decode function, but I have used try? here to keep the code short.</em></p>
<h2 id="changing-data-types">
  Changing data types
  <a href="#changing-data-types" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>The lat &amp; lng coordinates are stored in the JSON as Strings, but need to be
converted to Doubles for the Swift struct.</p>
<p>This requires a custom init method for the Coordinates struct to do the
conversion from String to Double.</p>
<p>So here is the complete code for Swift 4 - again, if you don&rsquo;t want to create
your own playground, you can <a href="https://github.com/trozware/json">use mine</a>, this time looking at the Swift 4
JSON page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Foundation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> sampleDataAddress = <span style="color:#e6db74">&#34;https://jsonplaceholder.typicode.com/users&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> url = URL(string: sampleDataAddress)<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonData = <span style="color:#66d9ef">try</span>! Data(contentsOf: url)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">User</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> id: Int
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> username: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> email: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> phone: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> website: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> address: Address
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> company: Company
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Address</span>: Codable {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> street: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> suite: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> city: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> zipcode: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> geo: Coordinates
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Coordinates</span>: Codable {
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lat: Double
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">let</span> lng: Double
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>            <span style="color:#66d9ef">init</span>(from decoder: Decoder) <span style="color:#66d9ef">throws</span> {
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> values = <span style="color:#66d9ef">try</span> decoder.container(keyedBy: CodingKeys.<span style="color:#66d9ef">self</span>)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> latString = <span style="color:#66d9ef">try</span> values.decode(String.<span style="color:#66d9ef">self</span>, forKey: .lat)
</span></span><span style="display:flex;"><span>                <span style="color:#66d9ef">let</span> lngString = <span style="color:#66d9ef">try</span> values.decode(String.<span style="color:#66d9ef">self</span>, forKey: .lng)
</span></span><span style="display:flex;"><span>                lat = Double(latString) ?? <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>                lng = Double(lngString) ?? <span style="color:#ae81ff">0</span>
</span></span><span style="display:flex;"><span>            }
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Company</span>: Codable {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> catchPhrase: String
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">let</span> bs: String
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonDecoder = JSONDecoder()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> users = <span style="color:#66d9ef">try</span>? jsonDecoder.decode(Array&lt;User&gt;.<span style="color:#66d9ef">self</span>, from: jsonData)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>users?.count
</span></span><span style="display:flex;"><span>dump(users?.first)
</span></span></code></pre></div><p>For comparative purposes, I counted the lines of code in each, removing the
common boiler plate of the top of each and the two lines for displaying the
results in the playground. I also removed the blank lines which I always use a
lot in my code for readability but which are not relevant when comparing code
efficiency:</p>
<table>
<thead>
<tr>
<th>Version</th>
<th style="text-align:right">Lines</th>
<th style="text-align:right">Lines if lat &amp; lng are Strings</th>
</tr>
</thead>
<tbody>
<tr>
<td>Swift 3</td>
<td style="text-align:right">95</td>
<td style="text-align:right">93</td>
</tr>
<tr>
<td>Swift 4</td>
<td style="text-align:right">35</td>
<td style="text-align:right">28</td>
</tr>
</tbody>
</table>
<h2 id="encoding">
  Encoding
  <a href="#encoding" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Encoding back to JSON is very similar. In the Swift 3 version, I would have
written a method for each struct that created a Dictionary and then used
JSONSerialization to convert the Dictionary back to JSON. This is very verbose
and tedious to write so I am not going to bother to demonstrate it here.</p>
<p>But in Swift 4, this is even easier than decoding. Add this code to the end of
your Swift 4 JSON playground or playground page:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> users = users {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> jsonEncoder = JSONEncoder()
</span></span><span style="display:flex;"><span>    jsonEncoder.outputFormatting = .prettyPrinted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> backToJson = <span style="color:#66d9ef">try</span>? jsonEncoder.encode(users) {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> jsonString = String(data: backToJson, encoding: .utf8) {
</span></span><span style="display:flex;"><span>            print(jsonString)
</span></span><span style="display:flex;"><span>        }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>JSONEncoder</code> returns Data and I have converted that to a String for
checking. I set JSONEncoder&rsquo;s outputFormatting property to .prettyPrinted get a
more readable String.</p>
<p>Notice how the encoded data is not quite the same as I received because the lat
&amp; lng properties are now Doubles. In a production app, if I needed to be able to
convert back to JSON, I probably would have left them as Strings so as to enable
data transfer in both directions. I would add computed properties to the struct
to convert these Strings to Doubles as I needed them.</p>
<h2 id="advanced-decoding">
  Advanced Decoding
  <a href="#advanced-decoding" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Now that we have the basics, I want to look at three more features: changing
property names, date handling and allowing for nulls.</p>
<h2 id="changing-property-names">
  Changing Property Names
  <a href="#changing-property-names" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>In these examples I used exactly the same names for the properties as were used
in the JSON. In the Swift 3 version, it would have been easy to change the
property names, since the data for each property was being extracted manually.
In Swift 4, if you want the decoder to change names, you have to tell it what
you want.</p>
<p>Make a new playground or playground page and replace the contents with this - or
go to the Swift 4 Extras page on <a href="https://github.com/trozware/json">my playground</a>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">import</span> <span style="color:#a6e22e">Foundation</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonString = <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>name1<span style="color:#e6db74">&#34;: &#34;</span>Jane<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>name2<span style="color:#e6db74">&#34;: &#34;</span>Smith<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonData = jsonString.data(using: .utf8)<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Person</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> firstName: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> lastName: String
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonDecoder = JSONDecoder()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> person = <span style="color:#66d9ef">try</span>? jsonDecoder.decode(Person.<span style="color:#66d9ef">self</span>, from: jsonData)
</span></span><span style="display:flex;"><span>dump(person)
</span></span></code></pre></div><p>This uses the new multi-line literals in Swift 4 to assemble the JSON string
which is amazingly useful as it allows quotes to be embedded in the string
without having to escape them. As you can see, the JSON property names are not
very helpful, so I want to change them in my Person struct. At the moment,
<code>person</code> is nil because I have not given the decoder any clues to help it
translate the names. To do that, I have to add a CodingKeys enum to the Person
struct and it tells the decoder what names in the JSON match up to what
properties in the struct.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Person</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> firstName: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> lastName: String
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">enum</span> <span style="color:#a6e22e">CodingKeys</span>: String, CodingKey {
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> firstName = <span style="color:#e6db74">&#34;name1&#34;</span>
</span></span><span style="display:flex;"><span>        <span style="color:#66d9ef">case</span> lastName = <span style="color:#e6db74">&#34;name2&#34;</span>
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And that&rsquo;s all I have to do. Now the JSON is correctly converted to a Person. As
an exercise, use JSONEncoder to get back to JSON from the Person. You will see
that the JSON correctly names the elements using &ldquo;name1&rdquo; and &ldquo;name2&rdquo;.</p>
<h2 id="date-handling">
  Date Handling
  <a href="#date-handling" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>Next let&rsquo;s look at dates - add this code to the playground:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonString2 = <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">{
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>name<span style="color:#e6db74">&#34;: &#34;</span>My New Project<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;</span>created<span style="color:#e6db74">&#34;: &#34;</span><span style="color:#ae81ff">2017</span><span style="color:#f92672">-</span><span style="color:#ae81ff">06</span><span style="color:#f92672">-</span><span style="color:#ae81ff">18</span>T06:<span style="color:#ae81ff">28</span>:<span style="color:#ae81ff">25</span>Z<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">}
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonData2 = jsonString2.data(using: .utf8)<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Project</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> name: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> created: Date
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonDecoder2 = JSONDecoder()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> project = <span style="color:#66d9ef">try</span>? jsonDecoder2.decode(Project.<span style="color:#66d9ef">self</span>, from: jsonData2)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>dump(project)
</span></span></code></pre></div><p>When this runs, <code>project</code> is nil because the decoder has no idea how to get from
the String &ldquo;2017-06-18T06:28:25Z&rdquo; to a Date object. Add this line after creating
<code>jsonDecoder2</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>jsonDecoder2.dateDecodingStrategy = .iso8601
</span></span></code></pre></div><p>Now the date can be converted and an instance of the Project struct will be
created.</p>
<p>And to get back to the JSON, converting the Date back to ISO8601 format:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonEncoder = JSONEncoder()
</span></span><span style="display:flex;"><span>jsonEncoder.dateEncodingStrategy = .iso8601
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> backToJson = <span style="color:#66d9ef">try</span>? jsonEncoder.encode(project) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> jsonString = String(data: backToJson, encoding: .utf8) {
</span></span><span style="display:flex;"><span>        print(jsonString)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p><!-- raw HTML omitted --><!-- raw HTML omitted --></p>
<h2 id="allowing-for-nulls">
  Allowing For Nulls
  <a href="#allowing-for-nulls" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>JSON data will often include <strong>null</strong> where there is no value for a particular
property name. When using JSONDecoder or JSONEncoder, this can be allowed for by
using Optionals. If you are not clear about Optionals, have a look at my
previous article: <a href="/post/2016-02-12-learning-swift-optionals/">Learning Swift - Optionals</a>.</p>
<p>The crucial step is to declare the properties of the Swift object as optionals
if you think they could get a null value.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">struct</span> <span style="color:#a6e22e">Role</span>: Codable {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> firstName: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> lastName: String
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> nickName: String?
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonStringWithNulls = <span style="color:#e6db74">&#34;&#34;&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">[
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;</span>firstName<span style="color:#e6db74">&#34;: &#34;</span>Sally<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;</span>lastName<span style="color:#e6db74">&#34;: &#34;</span>Sparrow<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;</span>nickName<span style="color:#e6db74">&#34;: null
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    },
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    {
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;</span>firstName<span style="color:#e6db74">&#34;: &#34;</span>Doctor<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;</span>lastName<span style="color:#e6db74">&#34;: &#34;</span>Who<span style="color:#e6db74">&#34;,
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">        &#34;</span>nickName<span style="color:#e6db74">&#34;: &#34;</span>The Doctor<span style="color:#e6db74">&#34;
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">    }
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">]
</span></span></span><span style="display:flex;"><span><span style="color:#e6db74">&#34;&#34;&#34;</span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonDataWithNulls = jsonStringWithNulls.data(using: .utf8)<span style="color:#f92672">!</span>
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonDecoder3 = JSONDecoder()
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">let</span> roles = <span style="color:#66d9ef">try</span>? jsonDecoder3.decode(Array&lt;Role&gt;.<span style="color:#66d9ef">self</span>, from: jsonDataWithNulls)
</span></span><span style="display:flex;"><span>dump(roles)
</span></span></code></pre></div><p>In this example (which you can find in the Swift 4 Extras page on <a href="https://github.com/trozware/json">my
playground</a>), I have declared a struct called Role with 3 String properties.
The 3rd String - nickName - is an Optional so it may be a String or it may be
nil.</p>
<p>The JSON contains 2 elements - one has a nickName value and the other has it as
null. Because the matching property in the Swift struct is an optional, this
works as expected and the nickName property for Sally Sparrow is decoded as nil.
If you remove the question mark to make nickName non-optional, the decoding will
fail.</p>
<p>Going back to JSON from a Swift object with optionals works much the same except
that it does not specifically mark items as null, it just leaves them out.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> jsonEncoder2 = JSONEncoder()
</span></span><span style="display:flex;"><span>jsonEncoder2.outputFormatting = .prettyPrinted
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> backToJsonWithNulls = <span style="color:#66d9ef">try</span>? jsonEncoder2.encode(roles) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> jsonString = String(data: backToJsonWithNulls, encoding: .utf8) {
</span></span><span style="display:flex;"><span>        print(jsonString)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><h2 id="property-lists">
  Property Lists
  <a href="#property-lists" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>As well as JSONDecoder and JSONEncoder, Swift 4 has introduced
PropertyListDecoder and PropertyListEncoder, so let&rsquo;s take a quick look at that.</p>
<p>Add this to the bottom of the last playground as it uses the Project struct and
data:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> plistEncoder = PropertyListEncoder()
</span></span><span style="display:flex;"><span>plistEncoder.outputFormat = .xml
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> plist = <span style="color:#66d9ef">try</span>? plistEncoder.encode(project) {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> plistString = String(data: plist, encoding: .utf8) {
</span></span><span style="display:flex;"><span>        print(plistString)
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> plistDecoder = PropertyListDecoder()
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">let</span> project2 = <span style="color:#66d9ef">try</span>? plistDecoder.decode(Project.<span style="color:#66d9ef">self</span>, from: plist)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    dump(project2)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I don&rsquo;t see this is being quite as useful as the JSON Encoding &amp; Decoding, but I
mention it here for completeness.</p>
<h2 id="codable">
  Codable
  <a href="#codable" class="h-anchor" aria-hidden="true">#</a>
</h2>
<p>In all the Swift 4 examples above, I set the structs to conform to <code>Codable</code>.
Reading Apple&rsquo;s docs, I see that <code>Codable</code> is actually a typealias referring to
2 separate protocols:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-Swift" data-lang="Swift"><span style="display:flex;"><span><span style="color:#66d9ef">typealias</span> Codable = Decodable <span style="color:#f92672">&amp;</span> Encodable
</span></span></code></pre></div><p>If you only need to convert data one way, it will be more efficient to set your
struct or class as confirming to only one of these protocols. For example, if
you download JSON data from an API but never need to send it back, just conform
to Decodable to transform the JSON data into your data structure.</p>
<p>Much more information can be found in the <a href="https://developer.apple.com/documentation/swift/encoding_decoding_and_serialization">Apple documentation</a>.</p></div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <a class="btn next" href="https://troz.net/post/2017/moving-to-hugo/"
        > Moving to Hugo</a
      >
       
      <a class="btn previous" href="https://troz.net/post/2017/posting-from-my-new-ipad/"
        >Posting from my new iPad </a
      >
      
    </div>
  </div>
  
</div>

      </div>

      
        <link rel="stylesheet" href="/css/footer.css" />

<footer class="footer">
  <div class="footer__inner">
    <div class="social_footer">
      <a
        id="email-Link"
        class="mailtoui"
        href="mailto:sarah@troz.net"
        aria-label="Email me"
        ><img src="/icons/envelope.svg" alt=""
      /></a>
      
      <a
        rel="me"
        href="https://mastodon.social/@troz"
        aria-label="Follow me on Mastodon"
        ><img src="/icons/mastodon.png" alt=""
      /></a>

      <a href="https://linktr.ee/trozware" aria-label="Check out all my links"
        ><img src="/icons/tree.svg" alt=""
      /></a>

      <a
        href="https://github.com/trozware"
        aria-label="Look at my code on Github"
        ><img src="/icons/github.svg" alt=""
      /></a>

      <a
        href="https://stackoverflow.com/users/1082632"
        aria-label="Check out my Stack Overflow profile"
        ><img src="/icons/stack-overflow.svg" alt=""
      /></a>

      <a href="https://troz.net/index.xml" aria-label="Subscribe to my RSS feed"
        ><img src="/icons/rss.svg" alt=""
      /></a>
      <a
        href="https://troz.net/feed.json"
        aria-label="Subscribe to my JSON feed"
        ><img src="/icons/json.png" alt=""
      /></a>

      <a href="https://dev.to/trozware" aria-label="Check out my DEV profile">
        <img
          src="/icons/dev-badge.svg"
          alt=""
          alt="TrozWare's DEV Profile"
          style="height: 37px; margin-top: -3px"
          height="40"
          width="40"
        />
      </a>

      <a
        href="https://ko-fi.com/H2H3BU7SI"
        target="_blank"
        aria-label="Buy me a coffee"
        ><img
          height="36"
          style="border: 0px; height: 36px; width: unset"
          src="https://cdn.ko-fi.com/cdn/kofi1.png?v=3"
          border="0"
          alt="Buy Me a Coffee at ko-fi.com"
      /></a>
    </div>
  </div>

  <div class="footer__inner">
    <div class="copyright">
      
      <span> 2012 - 2023 Sarah Reichelt</span>
      
      <span
        ><a href="http://gohugo.io">Hugo</a> theme created by
        <a href="https://twitter.com/panr">panr</a> 2018</span
      >
    </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


<script src="https://cdn.jsdelivr.net/npm/mailtoui@latest/dist/mailtoui-min.js"></script>


<script src="https://polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
<script src="/quicklink.js"></script>

<script>
  window.addEventListener('load', () => {
    quicklink()
  })
</script>


      
    </div>

    
  </body>
</html>

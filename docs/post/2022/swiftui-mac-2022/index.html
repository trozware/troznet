<!DOCTYPE html>
<html lang="en">
  <head>
    
      <title>
        SwiftUI for Mac 2022 ::
        TrozWare
      </title>
    
    <meta http-equiv="content-type" content="text/html; charset=utf-8" />
<meta name="viewport" content="width=device-width, initial-scale=1.0" />
<meta
  name="description"
  content="In December 2019, I wrote a series of articles about using SwiftUI to build a Mac app. And in July 2020, I re-visited the sample app to apply the new SwiftUI features made available in macOS BigSur. Now that macOS Ventura and Xcode 14 are in beta, it&amp;rsquo;s time to build the app again while learning how to incorporate the new APIs.
"
/>
<meta
  name="keywords"
  content="[Swift Apple macOS iOS Apple Watch]"
/>
<meta name="robots" content="noodp" />
<link rel="canonical" href="https://troz.net/post/2022/swiftui-mac-2022/" />







<link rel="stylesheet" href="/css/style.css" />

<link rel="stylesheet" href="https://troz.net/style.css" />


<link rel="apple-touch-icon-precomposed" sizes="144x144" href="https://troz.net/img/apple-touch-icon-144-precomposed.png" />
<link rel="shortcut icon" href="https://troz.net/img/favicon.png" />


<link href="/fonts/Inter-Italic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Regular.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Medium.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-MediumItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-Bold.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">
<link href="/fonts/Inter-BoldItalic.woff2" rel="preload" type="font/woff2" as="font" crossorigin="">


<meta name="twitter:card" content="summary"/>
<meta name="twitter:title" content="SwiftUI for Mac 2022"/>
<meta name="twitter:description" content="Mac app development using SwiftUI on macOS Ventura"/>



<meta property="og:title" content="SwiftUI for Mac 2022" />
<meta property="og:description" content="Mac app development using SwiftUI on macOS Ventura" />
<meta property="og:type" content="article" />
<meta property="og:url" content="https://troz.net/post/2022/swiftui-mac-2022/" /><meta property="article:section" content="post" />
<meta property="article:published_time" content="2022-06-17T14:18:32+10:00" />
<meta property="article:modified_time" content="2022-06-17T14:18:32+10:00" />






  </head>
  <body >
    <div class="container">
      <header class="header">
  <span class="header__inner">
    <a
  href="https://troz.net/"
  class="logo"
  style="text-decoration: none;"
>
  
    <span class="logo__mark"><svg xmlns="http://www.w3.org/2000/svg" class="greater-icon" viewBox="0 0 44 44">
  <path fill="none" d="M15 8l14.729 14.382L15 35.367" />
</svg>
</span>
    <span class="logo__text"
      >TrozWare</span
    >
    <span class="logo__cursor"></span>
  
</a>

    <span class="header__right">
      
        <nav class="menu">
  <ul class="menu__inner menu__inner--desktop">
    
      
        
          <li><a href="/">Home</a></li>
        
      
        
          <li><a href="/apps/">Apps</a></li>
        
      
        
          <li><a href="/post/">Archives</a></li>
        
      
        
          <li><a href="/tags/">Tags</a></li>
        
      
        
          <li><a href="/contact/">Contact</a></li>
        
      
    
  </ul>

  <ul class="menu__inner menu__inner--mobile">
    
      
        <li><a href="/">Home</a></li>
      
    
      
        <li><a href="/apps/">Apps</a></li>
      
    
      
        <li><a href="/post/">Archives</a></li>
      
    
      
        <li><a href="/tags/">Tags</a></li>
      
    
      
        <li><a href="/contact/">Contact</a></li>
      
    
  </ul>
</nav>

        <span class="menu-trigger">
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24">
            <path d="M0 0h24v24H0z" fill="none" />
            <path d="M3 18h18v-2H3v2zm0-5h18v-2H3v2zm0-7v2h18V6H3z" />
          </svg>
        </span>
      
      <span class="theme-toggle">
        <svg
  class="theme-toggler"
  width="24"
  height="24"
  viewBox="0 0 48 48"
  fill="none"
  xmlns="http://www.w3.org/2000/svg"
>
  <path
    d="M22 41C32.4934 41 41 32.4934 41 22C41 11.5066 32.4934 3 22
  3C11.5066 3 3 11.5066 3 22C3 32.4934 11.5066 41 22 41ZM7 22C7
  13.7157 13.7157 7 22 7V37C13.7157 37 7 30.2843 7 22Z"
  />
</svg>

      </span>
    </span>
  </span>
</header>


      <div class="content">
        

<link rel="stylesheet" href="/css/header.css" />

<div class="post">
  <h2 class="post-title">
    <a href="https://troz.net/post/2022/swiftui-mac-2022/">SwiftUI for Mac 2022</a>
  </h2>
  <div class="post-meta">
    <span class="post-date">
      17 Jun 2022
    </span>
    <span class="more-meta">- 3009 words, </span>
    <span class="more-meta"> 15 minute read</span>
  </div>

  
  <span class="post-tags">
     #<a
      href="https://troz.net/tags/swift"
      >swift</a
    >&nbsp;  #<a
      href="https://troz.net/tags/swiftui"
      >swiftui</a
    >&nbsp;  #<a
      href="https://troz.net/tags/mac"
      >mac</a
    >&nbsp; 
  </span>
   

  <div class="post-content"><p>In December 2019, I wrote a <a href="/post/2019/swiftui-for-mac-1/">series of articles about using SwiftUI to build a Mac app</a>. And in July 2020, I <a href="/post/2020/swiftui_mac_big_sur/">re-visited the sample app</a> to apply the new SwiftUI features made available in macOS BigSur. Now that macOS Ventura and Xcode 14 are in beta, it&rsquo;s time to build the app again while learning how to incorporate the new APIs.</p>
<p>Right now, it&rsquo;s June 2022 and I&rsquo;m using macOS Ventura 13 beta 2 (22A5286j) with Xcode 14 beta 2 (14A5229c). There will undoubtedly be changes before release, but I&rsquo;ll try to update this article or add notes to point out any major differences.</p>
<p>I don&rsquo;t intend to cover features that haven&rsquo;t changed much, but here are the new APIs that I am interested in:</p>
<ul>
<li><a href="#navigation">Navigation</a></li>
<li><a href="#detecting-the-active-window">Detecting the Active Window</a></li>
<li><a href="#opening-new-windows">Opening New Windows</a></li>
<li><a href="#charts">Charts</a></li>
<li><a href="#image-rendering">Image Rendering</a></li>
<li><a href="#forms">Forms</a></li>
<li><a href="#menu-bar-apps">Menu Bar Apps</a></li>
</ul>
<p><strong>Note</strong>: In Xcode 14 beta 2, the SwiftUI Previews are crashing unless I go to Project &gt; Target &gt; Signing &amp; Capabilities and select my developer team and set Signing Certificate to Development. So if you can&rsquo;t see the Previews, make these changes, or run the app directly.</p>
<h3 id="navigation">
  Navigation
  <a href="#navigation" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>The <a href="https://github.com/trozware/swiftui-mac">first version of this app</a> used a two pane layout with a sectioned list in the sidebar leading to a detail view in the main area. With the <a href="https://github.com/trozware/swiftui-mac-11">Big Sur version</a>, I switched to a three pane layout because the sections were not displaying neatly. This time, I&rsquo;ve reverted to two panes with sections. As before, I&rsquo;m using <a href="https://http.cat">HTTP Cats</a> which is a site that serves up a cat image to match almost every HTTP status code.</p>
<p>Previous versions used <code>NavigationLinks</code> inside a <code>NavigationView</code>. <code>NavigationView</code> is now deprecated and we should use either <code>NavigationStackView</code> or <code>NavigationSplitView</code>. <code>NavigationStackView</code> is better suited to a small screen where each view is pushed on to a stack and can be popped off to navigate back. I am going to use <code>NavigationSplitView</code> which works well for bigger displays with all the panes visible at once.</p>
<p>My data model is exactly the same as I developed originally and consists of an array of <code>HttpSections</code>, each containing an array of <code>HttpStatuses</code>.
So I was able to render my navigation like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>NavigationSplitView {
</span></span><span style="display:flex;"><span>  List(httpSections, selection: <span style="color:#960050;background-color:#1e0010">$</span>selectedStatus) { section <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>    Section(header: Text(<span style="color:#e6db74">&#34;</span><span style="color:#e6db74">\(</span>section.headerCode<span style="color:#e6db74">)</span><span style="color:#e6db74"> - </span><span style="color:#e6db74">\(</span>section.headerText<span style="color:#e6db74">)</span><span style="color:#e6db74">&#34;</span>)) {
</span></span><span style="display:flex;"><span>      ForEach(section.statuses) { status <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>        SidebarRowView(code: status.code, title: status.title)
</span></span><span style="display:flex;"><span>          .tag(status)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>    .font(.headline)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  .frame(minWidth: <span style="color:#ae81ff">250</span>)
</span></span><span style="display:flex;"><span>} detail: {
</span></span><span style="display:flex;"><span>  DetailView(sectionTitle: sectionHeader, httpStatus: selectedStatus)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>The <code>NavigationSplitView</code> takes various parameters, depending on the result you want. In this case, the first parameter lays out the sidebar, which is a <code>List</code>. The detail parameter contains the detail view. For the <code>List</code>, I loop through the sections, adding a section header for each one and a custom <code>SidebarRowView</code> to display the individual status entries. The <code>List</code> selection is bound to an optional <code>HttpStatus</code>. The key here is to give each row a <code>tag</code> that maps to the status displayed in that row. If you omit the tag, the sidebar draws but none of the entries are selectable.</p>
<p>Interestingly, when you create a navigation setup like this, Xcode automatically adds a toolbar with a button to toggle the sidebar. This has always been essential as there is a long-standing bug where a hidden sidebar cannot be dragged back into view. But adding it manually meant digging into AppKit to find a method to call.</p>
<p>Not so interestingly, the sidebar is often hidden on app launch. I tried giving <code>NavigationStackView</code> its optional <code>columnVisibility</code> parameter, but no setting made it appear consistently.</p>
<p>With the detail, right now there is a bug where you cannot unwrap a conditional and show a view based on that. One workaround is to wrap the entire detail in a <code>ZStack</code>, but in the interest of keeping my <code>ContentView</code> code simple and as short as possible, I added an intermediary view. <code>DetailView</code> takes optional parameters and it decides whether to show the <code>StatusView</code> or a placeholder. Note: the bug may have gone in beta 2, but as I want to display other UI elements in the detail view anyway, this is still a neater approach.</p>
<p>There is nothing much new in either of these views, except where <code>StatusView</code> downloads the selected cat image. I tried using <code>AsyncImage</code> which worked really well except for one problem. When I selected a new status, the old image stayed in place until the new one arrived. I was unable to work out how to clear or reset an <code>AsyncImage</code> so it would show its placeholder again.</p>
<p><strong>Update</strong>: Thanks to <a href="https://twitter.com/ramzesenok">@ramzesenok</a> who pointed out that this is another case where I could use an <code>id</code> to force a refresh. So now, the app uses <code>AsyncImage</code> which makes for a lot less code.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>AsyncImage(url: httpStatus.imageUrl) { img <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>  CatImageView(catImage: img, statusCode: httpStatus.code)
</span></span><span style="display:flex;"><span>} placeholder: {
</span></span><span style="display:flex;"><span>  ProgressView()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.id(httpStatus)   <span style="color:#75715e">// this resets the AsyncImage whenever httpStatus changes</span>
</span></span></code></pre></div><p>If anyone is still interested in the <code>async/await</code> version, check out this <a href="https://github.com/trozware/swiftui-mac-2022/tree/55dc61b57f50379e4a4b0c247014af521d866c5d">earlier commit on GitHub</a>. It does appear to have better/faster caching, but a beta is not the right place to make speed assessments.</p>
<p><del>However I did switch to using <code>async/await</code> to download the image.</del></p>
<p><del>Updating this was also slightly complicated. I downloaded the first selected image using a <code>task</code> modifier and downloaded subsequent selections using an <code>onChange</code> modifier. Both of these were required to show the image every time.</del></p>
<p><del>Thanks to <a href="https://twitter.com/davbeck">@davbeck</a>, <a href="https://twitter.com/malhal">@malhal</a> and <a href="https://twitter.com/chriseidhof">@chriseidhof</a> for pointing out that if I gave the <code>task</code> an <code>id</code>, it would be called whenever the <code>id</code> property changed.</del></p>
<style>
  img {
    margin: 10px auto;
    border: 0.5rem #dfe7f0 solid;
    border-radius: 0.5rem;
     
  }

  .dark-theme img {
    margin: 10px auto;
    border: 0.5rem #4a4d50 solid;
    border-radius: 0.5rem;
     
  }

  .social_footer img {
    border: none;
    box-shadow: none;
  }
</style>

<p><del>The previous image is first set to <code>nil</code>, so that the progress indicator appears.</del></p>
<p>With all this in place, I had the basis of the app and the navigation was complete:</p>
<p><img src="/images/navigation_2022.jpg" alt="Navigation"></p>
<h3 id="detecting-the-active-window">
  Detecting the Active Window
  <a href="#detecting-the-active-window" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>macOS apps can have multiple windows open at once, and in previous iterations of SwiftUI, it has been difficult to detect the active one. Last year, we got <code>@FocusedBinding</code> but it didn&rsquo;t really work. This year it works, but we also have a new <code>EnvironmentValue</code> called <code>controlActiveState</code>.</p>
<p>As I did last time, I set up some menus by adding a <code>commands</code> modifier to my <code>WindowGroup</code> in the main _App.swift file. First, I added the pre-built <code>SidebarCommands()</code> which added a menu item and keyboard shortcut for toggling the sidebar. Next, I added a menu item for flipping the image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>CommandGroup(after: .textEditing) {
</span></span><span style="display:flex;"><span>  Button(<span style="color:#e6db74">&#34;Flip Image&#34;</span>) {
</span></span><span style="display:flex;"><span>    NotificationCenter.<span style="color:#66d9ef">default</span>.post(name: .flipImage, object: <span style="color:#66d9ef">nil</span>)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>  .keyboardShortcut(<span style="color:#e6db74">&#34;f&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This new item appears in the Edit menu, after the standard items. It has a shortcut of Command-F. The Command key is the default shortcut modifier, so if you only specify a letter, it automatically uses Command. All this menu item does is to broadcast a notification.</p>
<p>The image is shown in a subview called <code>CatImageView</code> which now includes the following properties:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@Environment(<span style="color:#960050;background-color:#1e0010">\</span>.controlActiveState) <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> controlActiveState
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span><span style="color:#66d9ef">private</span> <span style="color:#66d9ef">let</span> flipImageMenuItemSelected = NotificationCenter.<span style="color:#66d9ef">default</span>
</span></span><span style="display:flex;"><span>  .publisher(<span style="color:#66d9ef">for</span>: .flipImage)
</span></span><span style="display:flex;"><span>  .receive(on: RunLoop.main)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>@State <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> imageIsFlipped = <span style="color:#66d9ef">false</span>
</span></span></code></pre></div><p>The image has a <code>rotation3Deffect</code> modifier with the angle set to either 0 degrees, or 180 degrees, depending on the value of <code>imageIsFlipped</code>.</p>
<p>The view subscribes to the <code>flipImage</code> notification and receives it like this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>.onReceive(flipImageMenuItemSelected) { <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> controlActiveState == .key <span style="color:#f92672">||</span> controlActiveState == .active {
</span></span><span style="display:flex;"><span>    imageIsFlipped.toggle()
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>When the notification arrives, the code checks the value of <code>controlActiveState</code>. In my tests, this was always either <code>key</code> or <code>inactive</code>, but I saw that <code>active</code> was an option and added it too, in case it becomes relevant later. If the <code>CatImageView</code> is in the active window, it flips the image and if not, this notification is ignored.</p>
<p><img src="/images/target_active_window.jpg" alt="Target Active Window"></p>
<p>As you can see from the text in the images, only the front window image is flipped.</p>
<h3 id="opening-new-windows">
  Opening New Windows
  <a href="#opening-new-windows" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>In early versions of SwiftUI, opening a secondary window was a very complex process. Read <a href="https://troz.net/post/2019/swiftui-for-mac-2/">part 2 of the original series</a> to see how I struggled with this. Later, we got an easy way to open a Preferences window, using a <code>Settings</code> scene. Preferences are now called Settings, which makes this nomenclature more logical.</p>
<p>Last year, we got the ability to use a <code>NavigationLink</code> as a SwiftUI menu item and this will open the destination view in a new window.</p>
<p>This year, we have a new method that uses another new <code>EnvironmentValue</code> called <code>openWindow</code>. First, in the _App.swift file, I added another new scene to the body - this time a second <code>WindowGroup</code>. A <code>WindowGroup</code> can be passed an <code>id</code>, a data object of a specific type, or both. In this case, I didn&rsquo;t want to pass any data, so I gave it an <code>id</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>WindowGroup(id: <span style="color:#e6db74">&#34;ui_samples&#34;</span>) {
</span></span><span style="display:flex;"><span>  SamplesView()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I want to display a window with a view demonstrating some UI elements. The view is called <code>SamplesView</code>, so I set this as the content of the <code>WindowGroup</code>.</p>
<p>To use it, I added a property to <code>DetailView</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@Environment(<span style="color:#960050;background-color:#1e0010">\</span>.openWindow) <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> openWindow
</span></span></code></pre></div><p>And inserted a <code>Button</code> to call it:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>Button(<span style="color:#e6db74">&#34;Show UI Samples&#34;</span>) {
</span></span><span style="display:flex;"><span>  openWindow(id: <span style="color:#e6db74">&#34;ui_samples&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This opens a new window with the appropriate <code>id</code>. This can open multiple copies of the same window. If I had passed a data object to the window, it would have brought the window containing that data object to the front instead of opening a new window. To test this behavior, I changed the <code>WindowGroup</code> to this:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>WindowGroup(<span style="color:#66d9ef">for</span>: String.<span style="color:#66d9ef">self</span>) { <span style="color:#66d9ef">_</span> <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>  SamplesView()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>And changed the <code>Button</code> to:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>Button(<span style="color:#e6db74">&#34;Show UI Samples&#34;</span>) {
</span></span><span style="display:flex;"><span>  openWindow(value: <span style="color:#e6db74">&#34;samples&#34;</span>)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Now the <code>WindowGroup</code> expects a <code>String</code>. When you pass a <code>String</code> that has already been attached to a window, that window is brought to the front. If you pass a different <code>String</code>, you get a new window.</p>
<p>After that, I realized that there was another scene type I could use. If you create a <code>Window</code> scene instead of a <code>WindowGroup</code>, not only does this become a single presentation window, but you get a menu item for it in the Window menu without any extra work. You can add a keyboard shortcut to the <code>Window</code> scene too. Supposedly, you can add default sizing and positioning, but they don&rsquo;t appear to work yet.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>Window(<span style="color:#e6db74">&#34;Samples&#34;</span>, id: <span style="color:#e6db74">&#34;ui_samples&#34;</span>) {
</span></span><span style="display:flex;"><span>  SamplesView()
</span></span><span style="display:flex;"><span>}
</span></span><span style="display:flex;"><span>.keyboardShortcut(<span style="color:#e6db74">&#34;u&#34;</span>)
</span></span><span style="display:flex;"><span>.defaultPosition(.topLeading)  <span style="color:#75715e">// doesn&#39;t work yet</span>
</span></span><span style="display:flex;"><span>.defaultSize(width: <span style="color:#ae81ff">600</span>, height: <span style="color:#ae81ff">600</span>)  <span style="color:#75715e">// doesn&#39;t work yet</span>
</span></span></code></pre></div><h3 id="charts">
  Charts
  <a href="#charts" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>One of the signature features of SwiftUI at WWDC 2022 was the new Charts API. I have struggled with charts in the past, so this was very interesting. I need to learn more, but I added a simple bar chart to the samples window:</p>
<p><img src="/images/bar_chart.jpg" alt="Bar chart"></p>
<p>This charts the number of entries in each category of HTTP status. I drew a line across at the 8 value because drawing a marker line is a feature I have often needed in charts.</p>
<p>Creating the chart was smooth:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>Chart {
</span></span><span style="display:flex;"><span>  ForEach(chartData.keys.sorted(), id: <span style="color:#960050;background-color:#1e0010">\</span>.<span style="color:#66d9ef">self</span>) { key <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>    BarMark(
</span></span><span style="display:flex;"><span>      x: .value(<span style="color:#e6db74">&#34;Category&#34;</span>, key),
</span></span><span style="display:flex;"><span>      y: .value(<span style="color:#e6db74">&#34;Count&#34;</span>, chartData[key] ?? <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>    .foregroundStyle(by: .value(<span style="color:#e6db74">&#34;Color&#34;</span>, key))
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  RuleMark(y: .value(<span style="color:#e6db74">&#34;Threshold&#34;</span>, <span style="color:#ae81ff">8</span>))
</span></span><span style="display:flex;"><span>    .foregroundStyle(.gray)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Having assembled a dictionary of category codes and counts, I looped through the keys, setting an <code>x</code> and <code>y</code> value for each in its own <code>BarMark</code>. The line used a <code>RuleMark</code>.</p>
<p>To get the different colors, I added this modifier to the <code>Chart</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>.chartForegroundStyleScale([
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;1xx&#34;</span>: .green,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;2xx&#34;</span>: .purple,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;3xx&#34;</span>: .blue,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;4xx&#34;</span>: .yellow,
</span></span><span style="display:flex;"><span>  <span style="color:#e6db74">&#34;5xx&#34;</span>: .red
</span></span><span style="display:flex;"><span>])
</span></span></code></pre></div><p>which was used by <code>foregroundStyle</code> to assign a different color to each of the categories.</p>
<p>Next, I wanted to add the ability to switch between vertical and horizontal bars. This requires swapping the <code>x</code> and <code>y</code> data so that <code>y</code> has the category and <code>x</code> has the count. After testing this manually, I added a Boolean to specify the orientation, and a method for returning the appropriate <code>BarMark</code>:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">func</span> <span style="color:#a6e22e">barMark</span>(<span style="color:#66d9ef">for</span> key: String) -&gt; BarMark {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> drawHorizontal {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> BarMark(
</span></span><span style="display:flex;"><span>      x: .value(<span style="color:#e6db74">&#34;Count&#34;</span>, chartData[key] ?? <span style="color:#ae81ff">0</span>),
</span></span><span style="display:flex;"><span>      y: .value(<span style="color:#e6db74">&#34;Category&#34;</span>, key)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  } <span style="color:#66d9ef">else</span> {
</span></span><span style="display:flex;"><span>    <span style="color:#66d9ef">return</span> BarMark(
</span></span><span style="display:flex;"><span>      x: .value(<span style="color:#e6db74">&#34;Category&#34;</span>, key),
</span></span><span style="display:flex;"><span>      y: .value(<span style="color:#e6db74">&#34;Count&#34;</span>, chartData[key] ?? <span style="color:#ae81ff">0</span>)
</span></span><span style="display:flex;"><span>    )
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>A similar method provided the <code>RuleMark</code> as either a vertical or horizontal line.</p>
<p>A segmented picker switches between the two and the only thing now was to animate the change. There is an <code>animation</code> modifier added last year that allows you to connect an animation to a property, so that when the property changes, the animation is triggered.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>.animation(.easeInOut, value: drawHorizontal)
</span></span></code></pre></div><p><img src="/images/chart_animation.mp4" alt="Animated chart"></p>
<p>I added <code>Text</code> views for the title of the chart and for the axes, inside a  <code>VStack</code> and an <code>HStack</code>, rotating the text for vertical axis. Maybe there is a chart setting that I&rsquo;m missing for adding these labels automatically using the Chart library.</p>
<h3 id="image-rendering">
  Image Rendering
  <a href="#image-rendering" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>While investigating charts, I experimented with another new SwiftUI feature: <code>ImageRenderer</code>. When I have made charts, I&rsquo;ve often wanted to export them as images for upload. <code>ImageRenderer</code> allows us to convert a SwiftUI view into an image: on macOS, either <code>NSImage</code> or <code>CGImage</code>.</p>
<p>The first step was to convert the chart view plus its labels, into a variable (modifiers and RuleMark omitted from this code snippet for brevity):</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span><span style="color:#66d9ef">let</span> chartView = Group {
</span></span><span style="display:flex;"><span>  Text(<span style="color:#e6db74">&#34;Status codes by category&#34;</span>)
</span></span><span style="display:flex;"><span>    .font(.title3).bold()
</span></span><span style="display:flex;"><span>    .padding()
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  HStack {
</span></span><span style="display:flex;"><span>    Text(drawHorizontal ? <span style="color:#e6db74">&#34;Category&#34;</span> : <span style="color:#e6db74">&#34;Count&#34;</span>).bold()
</span></span><span style="display:flex;"><span>      .rotationEffect(.degrees(<span style="color:#ae81ff">270</span>))
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>    Chart {
</span></span><span style="display:flex;"><span>      ForEach(chartData.keys.sorted(), id: <span style="color:#960050;background-color:#1e0010">\</span>.<span style="color:#66d9ef">self</span>) { key <span style="color:#66d9ef">in</span>
</span></span><span style="display:flex;"><span>        barMark(<span style="color:#66d9ef">for</span>: key)
</span></span><span style="display:flex;"><span>      }
</span></span><span style="display:flex;"><span>    }
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  Text(drawHorizontal ? <span style="color:#e6db74">&#34;Count&#34;</span> : <span style="color:#e6db74">&#34;Category&#34;</span>).bold()
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Then I displayed the view using the variable:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>VStack {
</span></span><span style="display:flex;"><span>  chartView
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#75715e">// Picker &amp; Button</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>This left the display unchanged, but allowed me to use this variable to create a view for rendering, omitting the controls that should not be part of the image:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>Button(<span style="color:#e6db74">&#34;Save Chart as Image&#34;</span>) {
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> view = chartView
</span></span><span style="display:flex;"><span>    .padding()
</span></span><span style="display:flex;"><span>    .frame(width: <span style="color:#ae81ff">1200</span>, height: <span style="color:#ae81ff">800</span>)
</span></span><span style="display:flex;"><span>
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">let</span> renderer = ImageRenderer(content: view)
</span></span><span style="display:flex;"><span>  <span style="color:#66d9ef">if</span> <span style="color:#66d9ef">let</span> exportImage = renderer.nsImage {
</span></span><span style="display:flex;"><span>    saveImage(exportImage)
</span></span><span style="display:flex;"><span>  }
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>I added <code>padding</code> and <code>frame</code> modifiers to the view variable as it came out very small without this. Then I created an <code>ImageRenderer</code> using this view and converted it into an <code>NSImage</code>.
The <code>saveImage</code> method uses an <code>NSSavePanel</code> to get a URL and then convert the NSImage to JPG data before writing it out. I used the same technique in <a href="https://troz.net/post/2019/swiftui-for-mac-3/">part 3 of the original series</a> but that only exported the downloaded image. This creates an image from a complete SwiftUI view.</p>
<p>I would be interested to try the SwiftUI <code>fileExporter</code>, but that&rsquo;s for another day.</p>
<p>I also tried to use the new <code>ShareLink</code> to share this image, but couldn&rsquo;t get that to work. The <code>ImageRenderer</code> seems to work asynchronously so that didn&rsquo;t work well with <code>ShareLink</code>. Again, that&rsquo;s for another day.</p>
<h3 id="forms">
  Forms
  <a href="#forms" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>SwiftUI has always had a <code>Form</code> object, but the new System Settings app (previously System Preferences) has taken this to a new level. So I added some UI elements to a second tab in the UI Samples window.</p>
<p><img src="/images/form.jpg" alt="Form"></p>
<p>There are a few interesting things here. Firstly, I achieved something I was unable to do last time and that is to make the text edit field have focus when the view opens. This was a three part operation:</p>
<p>Firstly, I added this property to the view:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>@FocusState <span style="color:#66d9ef">private</span> <span style="color:#66d9ef">var</span> emailFieldHasFocus: Bool
</span></span></code></pre></div><p>Then, I added this modifier to the edit field:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>TextField(<span style="color:#e6db74">&#34;Enter your email address&#34;</span>, text: <span style="color:#960050;background-color:#1e0010">$</span>email)
</span></span><span style="display:flex;"><span>  .focused(<span style="color:#960050;background-color:#1e0010">$</span>emailFieldHasFocus)
</span></span></code></pre></div><p>And finally, I set the Boolean property in the <code>onAppear</code> modifier:</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>.onAppear {
</span></span><span style="display:flex;"><span>  emailFieldHasFocus = <span style="color:#66d9ef">true</span>
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>With this in place, the email text entry field had the focus whenever this view appeared.</p>
<p>The date picker is slightly confused. It can&rsquo;t seem to decide whether it&rsquo;s a graphical picker or a numeric picker, but it works. I haven&rsquo;t tried the new date range picker yet.</p>
<p>With the check marks, I was trying to emulate the toggles in System Settings, where they are very small switches. I set the <code>toggleStyle</code> to <code>switch</code> which gave the right shape but it was big, like on an iPhone or iPad. The outermost form is set to use the <code>columns</code> <code>formStyle</code>. This lines up the labels and controls very neatly. But when I put the <code>Toggles</code> and <code>Picker</code> into an inner form with a style of <code>grouped</code>, I got the exact System Settings look I was going for.</p>
<p>As an aside, I love the way you can now apply control-specific modifiers to a container view and every appropriate view inside the container will use that setting. For example, I added <code>.toggleStyle(.switch)</code> to the <code>Form</code> view and it was applied to every <code>Toggle</code> inside it.</p>
<p>The final item in the form is a color picker. It opens up the standard macOS color picker and uses the selected color to fill the capsule beside it. The interesting thing is that the color has a <code>gradient</code> modifier. So you can see the faint gradient that is automatically applied to the shape.</p>
<h3 id="menu-bar-apps">
  Menu Bar Apps
  <a href="#menu-bar-apps" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>Writing a menu bar app has previously required using AppKit to create a <code>NSStatusItem</code>. Now, we can add a <code>MenuBarExtra</code> scene to the app body to create a menu bar app component.</p>
<div class="highlight"><pre tabindex="0" style="color:#f8f8f2;background-color:#272822;-moz-tab-size:4;-o-tab-size:4;tab-size:4;"><code class="language-swift" data-lang="swift"><span style="display:flex;"><span>MenuBarExtra(<span style="color:#e6db74">&#34;HTTP Status Code&#34;</span>, systemImage: <span style="color:#e6db74">&#34;number.circle&#34;</span>, isInserted: <span style="color:#960050;background-color:#1e0010">$</span>showMenuBar) {
</span></span><span style="display:flex;"><span>  MenuBarView(httpSections: <span style="color:#960050;background-color:#1e0010">$</span>httpSections)
</span></span><span style="display:flex;"><span>}
</span></span></code></pre></div><p>Setting the title without a <code>systemImage</code> shows the text as the menu bar title. when you specify a <code>systemImage</code>, the text is not displayed and the menu bar only shows the image.</p>
<p><code>MenuBarExtra</code> takes an <code>isInserted</code> parameter, so you can turn it off and on. I added this to the app&rsquo;s settings and stored it using <code>@AppStorage</code>.</p>
<p>I set up a new SwiftUI view that looped through the HTTP Status data and created a submenu for each category and set this as the <code>MenuBarExtra</code> view. This works and my menu bar component was functional. Selecting a status uses <code>NSWorkspace</code> to open the relevant documentation page at MDN.</p>
<p><img src="/images/menu_bar_extra.jpg" alt="MenuBarExtra"></p>
<h3 id="conclusion">
  Conclusion
  <a href="#conclusion" class="h-anchor" aria-hidden="true">#</a>
</h3>
<p>2022 is an exciting year to be a SwiftUI programmer. Apple has made it very clear that this is the way forward and as early adopters, we have the ability to influence how the framework develops, so keep filing those feedback reports! There have been some great new features this year: navigation is better than ever, the platforms are unifying and macOS is not getting left behind.</p>
<p>The project from this article is available on <a href="https://github.com/trozware/swiftui-mac-2022">GitHub</a>. And as usual, I&rsquo;d be thrilled to hear any suggestions, corrections or improvements. Please contact me using one of the links below or through the <a href="/contact/">Contact</a> page. And if you found this article, I&rsquo;d love you to <a href="https://ko-fi.com/trozware">buy me a coffee</a>.</p></div>
  
  <div class="pagination">
    <div class="pagination__title">
      <span class="pagination__title-h">Read other posts</span>
      <hr />
    </div>
    <div class="pagination__buttons">
      
      <a class="btn next" href="https://troz.net/post/2022/new_links/"
        >← New Links</a
      >
       
      <a class="btn previous" href="https://troz.net/post/2022/setup/"
        >Writing Setup →</a
      >
      
    </div>
  </div>
  
</div>

      </div>

      
        <link rel="stylesheet" href="/css/footer.css" />

<footer class="footer">
  <div class="footer__inner">
    <div class="social_footer">
      <a id="email-Link" class="mailtoui" href="mailto:sarah@troz.net"
        ><img src="/icons/envelope.svg"
      /></a>
      
      <a rel="me" href="https://mastodon.social/@troz"
        ><img src="/icons/mastodon.png"
      /></a>

      <a href="https://linktr.ee/trozware"><img src="/icons/tree.svg" /></a>

      <a href="https://github.com/trozware"><img src="/icons/github.svg" /></a>

      <a href="https://stackoverflow.com/users/1082632"
        ><img src="/icons/stack-overflow.svg"
      /></a>

      <a href="https://troz.net/index.xml"><img src="/icons/rss.svg" /></a>
      <a href="https://troz.net/feed.json"><img src="/icons/json.png" /></a>

      <a href="https://dev.to/trozware">
        <img
          src="/icons/dev-badge.svg"
          alt="TrozWare's DEV Profile"
          style="height: 37px; margin-top: -3px"
          height="40"
          width="40"
        />
      </a>

      <a href="https://ko-fi.com/H2H3BU7SI" target="_blank"
        ><img
          height="36"
          style="border: 0px; height: 36px; width: unset"
          src="https://cdn.ko-fi.com/cdn/kofi1.png?v=3"
          border="0"
          alt="Buy Me a Coffee at ko-fi.com"
      /></a>
    </div>
  </div>

  <div class="footer__inner">
    <div class="copyright">
      
      <span>© 2012 - 2023 Sarah Reichelt</span>
      
      <span
        ><a href="http://gohugo.io">Hugo</a> theme created by
        <a href="https://twitter.com/panr">panr</a> 2018</span
      >
    </div>
  </div>
</footer>

<script src="/assets/main.js"></script>
<script src="/assets/prism.js"></script>


<script src="https://cdn.jsdelivr.net/npm/mailtoui@latest/dist/mailtoui-min.js"></script>


<script src="https://polyfill.io/v2/polyfill.min.js?features=IntersectionObserver"></script>
<script src="/quicklink.js"></script>

<script>
  window.addEventListener('load', () => {
    quicklink()
  })
</script>


      
    </div>

    
  </body>
</html>

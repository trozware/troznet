<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>Singleton to Protocol &#8211; TrozWare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="macOS, iOS &amp;amp; watchOS Developer">
    <meta name="author" content="Sarah Reichelt">
    <meta name="keywords" content="">
    <link rel="canonical" href="http://localhost:4000/2016/02/singleton-to-protocol/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for TrozWare" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- MathJax -->
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="Singleton to Protocol">
    <meta property="og:description" content="macOS, iOS &amp;amp; watchOS Developer">
    <meta property="og:url" content="http://localhost:4000/2016/02/singleton-to-protocol/">
    <meta property="og:site_name" content="TrozWare">

    <!-- Twitter Card -->
    
        <meta name="twitter:card" content="summary" />
        
            <meta name="twitter:site" content="@trozware" />
        
        <meta name="twitter:title" content="" />
        <meta name="twitter:description" content="" />
        <meta name="twitter:url" content="/2016/02/singleton-to-protocol//2016/02/singleton-to-protocol/" />
        <meta name="twitter:image" content="" />
    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/icons/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-5511808-2', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">

	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://localhost:4000" class="site-title">TrozWare</a>
      <nav class="site-nav">
        <a href="/applications/">Apps</a>
<a href="/tags/">Tags</a>
<a href="/archives/">Archives</a>
<a href="/contact/">Contact</a>

      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    
    
    
      <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/1082632"></a>
    
    <a class="fa fa-rss" href="/feed.xml"></a>
    
      <a class="fa fa-twitter" href="https://twitter.com/trozware"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:sarah@troz.net"></a>
    
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>Singleton to Protocol</h1>
  <span class="post-meta">26 Feb 2016</span><br>
  
  <span class="post-meta small">
  
    3 minute read
  
  </span>
</div>

<article class="post-content">
  <p>I was driving through the town of <a href="https://en.wikipedia.org/wiki/Singleton,_New_South_Wales">Singleton</a> the other day and of course, it got me thinking about using singletons in my apps. Singletons were a commonly used pattern in Objective-C programming and appear in many of Apple’s own APIs, but seem to be increasingly frowned upon in the Swift world.</p>

<h3 id="so-what-is-a-singleton">So what is a singleton?</h3>

<p>A singleton is a class that only expects to have a single instance. Think of it as a global instance of a class. In some cases this makes perfect sense if there can only ever be one instance of a particular class or if there is a default variant that suits most cases e.g.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">UIApplication</span><span class="o">.</span><span class="n">shared</span>
<span class="kt">UserDefaults</span><span class="o">.</span><span class="n">standard</span>
<span class="kt">NotificationCenter</span><span class="o">.</span><span class="k">default</span>
<span class="kt">FileManager</span><span class="o">.</span><span class="k">default</span>
<span class="kt">URLSession</span><span class="o">.</span><span class="n">shared</span></code></pre></figure>

<p>If you are using an object with a property name of “shared”, “standard” or “default” you can be pretty sure it is an singleton.</p>

<h3 id="and-whats-the-problem-with-singletons">And what’s the problem with singletons?</h3>

<p>There are probably many different opinions here but I have two thoughts about this:</p>

<ol>
  <li>They are effectively global variables and global variables can make your code messy and un-predictable.</li>
  <li>If they can be accessed by multiple other objects, possibly at the same time, then you can get conflicts. These can be handled by clever use of background queues, but it isn’t easy.</li>
</ol>

<h3 id="what-to-use-instead">What to use instead?</h3>

<p>As I drove, I mused on a singleton that I had implemented recently. It was a logging utility that allowed any object in my app (mostly view controllers) to save a new entry to a log file. The basic structure of the Logger class was this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">Logger</span> <span class="p">{</span>
    <span class="kd">static</span> <span class="k">let</span> <span class="nv">sharedLogger</span> <span class="o">=</span> <span class="kt">Logger</span><span class="p">()</span>

    <span class="kd">func</span> <span class="nf">addToLog</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// use private functions to find log file URL</span>
      <span class="c1">// append event text with time stamp</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>Any object in my app could use the Logger like this:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kt">Logger</span><span class="o">.</span><span class="n">sharedLogger</span><span class="o">.</span><span class="nf">addToLog</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="n">newLogEvent</span><span class="p">)</span></code></pre></figure>

<p>When I got to think about how I was using this, I realised that instead of a Logger <em>object</em> that everything could use, what I really needed was a Loggable <em>behaviour</em> that I could apply &amp; restrict to the few classes that actually needed to log events. For me, this was the break-through:</p>

<blockquote>
  <p><strong>Create a behaviour, not an object.</strong></p>
</blockquote>

<p>As soon as I started thinking about this as a behaviour, a protocol became the obvious solution, so this is what I created:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">protocol</span> <span class="kt">Loggable</span> <span class="p">{</span>
  <span class="c1">// not declaring functions here</span>
  <span class="c1">// as they should NOT be over-written</span>
<span class="p">}</span>

<span class="kd">extension</span> <span class="kt">Loggable</span> <span class="p">{</span>

    <span class="kd">func</span> <span class="nf">addToLog</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="kt">String</span><span class="p">)</span> <span class="p">{</span>
      <span class="c1">// use private functions to find log file URL</span>
      <span class="c1">// append event text with time stamp</span>
    <span class="p">}</span>

<span class="p">}</span></code></pre></figure>

<p>We run immediately into one of the peculiarities of Swift protocol extensions which has been very well explained by <a href="http://cjwirth.com/2016/01/20/swift-protocol-extension-weirdness/">Caesar Wirth</a>. If I had declared <code class="highlighter-rouge">addToLog(_:)</code> in the protocol, then any class or struct conforming to this protocol would have been free to over-write this function and provide its own version. This is not what I wanted here - I wanted every object to use the same version. So I left the function declaration out of the protocol definition and only included it in the protocol extension.</p>

<p>To use this behaviour, a class or struct just has to be declared as conforming to the Loggable protocol:</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">class</span> <span class="kt">MyClass</span><span class="p">:</span> <span class="kt">Loggable</span> <span class="p">{</span>
    <span class="kd">func</span> <span class="nf">doSomething</span><span class="p">()</span> <span class="p">{</span>
        <span class="nf">addToLog</span><span class="p">(</span><span class="nv">event</span><span class="p">:</span> <span class="s">"I did something!"</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span></code></pre></figure>

<p>For my app, I knew that I would want all my NSViewControllers to be able to add log events, so instead of setting them all individually as conforming to the protocol, I used this shortcut which extends all NSViewControllers to conform to the protocol.</p>

<figure class="highlight"><pre><code class="language-swift" data-lang="swift"><span class="kd">extension</span> <span class="kt">NSViewController</span><span class="p">:</span> <span class="kt">Loggable</span> <span class="p">{}</span></code></pre></figure>

<p>I added this line to the Loggable.swift file where I declared the protocol and its extension, but outside both of them.</p>

<hr />

<p>Protocol-oriented programming is a new technique to me, so it really helps when I can find a practical example of where it solves a problem.</p>

<p>If you are new to POP, I highly recommend the <a href="https://developer.apple.com/videos/play/wwdc2015/408/">Crusty talk</a> from WWDC 2015. And this article by <a href="http://matthijshollemans.com/2015/07/22/mixins-and-traits-in-swift-2/">Matthijs Hollemans</a> was invaluable to me in demonstrating the problems with object inheritance that are solved by protocols.</p>


</article>

<br>
<!-- <a href="/tags/">Tags</a>: swift and learning swift -->
Tags: 

    <a href="/tags/#swift">swift</a>&nbsp;&nbsp;

    <a href="/tags/#learning swift">learning swift</a>&nbsp;&nbsp;

<hr>






  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'trozware';
    var disqus_identifier = '/2016/02/singleton-to-protocol';
    var disqus_title      = 'Singleton to Protocol';

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      Theme crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>).<br>
      &lt;/&gt; available on <a href="https://github.com/johnotander/pixyll">Github</a>.
    </small>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5511808-2', 'auto');
ga('send', 'pageview');

</script>


</body>
</html>

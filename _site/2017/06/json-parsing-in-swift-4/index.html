<!DOCTYPE html>
<html>
<head>
    <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <title>JSON Parsing in Swift 4 &#8211; TrozWare</title>
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="description" content="Parsing JSON in Swift 4 is now much easier than before and dozens of Swift 3 JSON libraries have just been sherlocked.">
    <meta name="author" content="Sarah Reichelt">
    <meta name="keywords" content="">
    <link rel="canonical" href="http://localhost:4000/2017/06/json-parsing-in-swift-4/">
    <link rel="alternate" type="application/rss+xml" title="RSS Feed for TrozWare" href="/feed.xml" />

    <!-- Custom CSS -->
    <link rel="stylesheet" href="/css/pixyll.css" type="text/css">

    <!-- Fonts -->
    <link href='//fonts.googleapis.com/css?family=Merriweather:900,900italic,300,300italic' rel='stylesheet' type='text/css'>
    <link href='//fonts.googleapis.com/css?family=Lato:900,300' rel='stylesheet' type='text/css'>
    
      <link href="//maxcdn.bootstrapcdn.com/font-awesome/4.5.0/css/font-awesome.min.css" rel="stylesheet">
    

    <!-- MathJax -->
    

    <!-- Verifications -->
    

    <!-- Open Graph -->
    <!-- From: https://github.com/mmistakes/hpstr-jekyll-theme/blob/master/_includes/head.html -->
    <meta property="og:locale" content="en_US">
    <meta property="og:type" content="article">
    <meta property="og:title" content="JSON Parsing in Swift 4">
    <meta property="og:description" content="macOS, iOS and watchOS Developer">
    <meta property="og:url" content="http://localhost:4000/2017/06/json-parsing-in-swift-4/">
    <meta property="og:site_name" content="TrozWare">

    <!-- Twitter Card -->
    
        <meta name="twitter:card" content="summary" />
        
            <meta name="twitter:site" content="@trozware" />
        
        <meta name="twitter:title" content="JSON Parsing in Swift 4" />
        <meta name="twitter:description" content="Parsing JSON in Swift 4 is now much easier than before and dozens of Swift 3 JSON libraries have just been sherlocked." />
        <meta name="twitter:url" content="http://localhost:4000/2017/06/json-parsing-in-swift-4/" />
        <meta name="twitter:image" content="http://localhost:4000/icons/apple-touch-icon-152x152.png" />
    

    <!-- Icons -->
    <link rel="apple-touch-icon" sizes="57x57" href="/icons/apple-touch-icon-57x57.png">
    <link rel="apple-touch-icon" sizes="114x114" href="/icons/apple-touch-icon-114x114.png">
    <link rel="apple-touch-icon" sizes="72x72" href="/icons/apple-touch-icon-72x72.png">
    <link rel="apple-touch-icon" sizes="144x144" href="/icons/apple-touch-icon-144x144.png">
    <link rel="apple-touch-icon" sizes="60x60" href="/icons/apple-touch-icon-60x60.png">
    <link rel="apple-touch-icon" sizes="120x120" href="/icons/apple-touch-icon-120x120.png">
    <link rel="apple-touch-icon" sizes="76x76" href="/icons/apple-touch-icon-76x76.png">
    <link rel="apple-touch-icon" sizes="152x152" href="/icons/apple-touch-icon-152x152.png">
    <link rel="apple-touch-icon" sizes="180x180" href="/icons/apple-touch-icon-180x180.png">
    <link rel="icon" type="image/png" href="/icons/favicon-192x192.png" sizes="192x192">
    <link rel="icon" type="image/png" href="/icons/favicon-160x160.png" sizes="160x160">
    <link rel="icon" type="image/png" href="/icons/favicon-96x96.png" sizes="96x96">
    <link rel="icon" type="image/png" href="/icons/favicon-16x16.png" sizes="16x16">
    <link rel="icon" type="image/png" href="/icons/favicon-32x32.png" sizes="32x32">

    
    <script type="text/javascript">
       (function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
       (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
       m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
       })(window,document,'script','//www.google-analytics.com/analytics.js','ga');
       ga('create', 'UA-5511808-2', 'auto');
       ga('send', 'pageview');
    </script>
    
</head>

<body class="site">

	

  <div class="site-wrap">
    <header class="site-header px2 px-responsive">
  <div class="mt2 wrap">
    <div class="measure">
      <a href="http://localhost:4000" class="site-title">TrozWare</a>
      <nav class="site-nav">
        <a href="/applications/">Apps</a>
<a href="/tags/">Tags</a>
<a href="/archives/">Archives</a>
<a href="/contact/">Contact</a>

      </nav>
      <div class="clearfix"></div>
      
        <div class="social-icons">
  <div class="social-icons-right">
    <a class="fa fa-rss" href="/feed.json"></a>
    <!-- <a class="fa fa-list-alt" href="/feed.json"></a> -->
    
      <a class="fa fa-github" href="https://github.com/trozware"></a>
    
    
    
      <a class="fa fa-stack-overflow" href="https://stackoverflow.com/users/1082632"></a>
    
    
      <a class="fa fa-twitter" href="https://twitter.com/trozware"></a>
    
    
    
    
    
      <a class="fa fa-envelope" href="mailto:sarah@troz.net"></a>
    
    
    
    
  </div>
  <div class="right">
    
    
    
  </div>
</div>
<div class="clearfix"></div>

      
    </div>
  </div>
</header>


    <div class="post p2 p-responsive wrap" role="main">
      <div class="measure">
        


<div class="post-header mb2">
  <h1>JSON Parsing in Swift 4</h1>
  <span class="post-meta">18 Jun 2017</span><br>
  
  <span class="post-meta small">
  
    13 minute read
  
  </span>
</div>

<article class="post-content">
  <p>Since <strong>JSON</strong> has become the de facto standard for data transfers around the internet, there has always been a lot of interest in Swift libraries to parse JSON into Swift classes or structs. Searching for “swift json library” on <a href="https://github.com/search?q=swift+json+library">GitHub</a> discovers 77 repositories. So why are there so many? And what has Swift 4 done to <em>sherlock</em> them all?</p>

<p>The problem has always been converting loosely typed JSON to strictly typed Swift which involves a lot of type casting, checking, optionals etc. Swift has always provided access to the Objective-C methods for converting JSON to and from NSData, NSDictionary and NSArray. (These are now called Data, Dictionary and Array, but those labels are so universal, that I sometimes feel a more specific nomenclature would be useful. Have you tried doing a search for ‘Data’?)</p>

<p>For sample data, I am using https://jsonplaceholder.typicode.com/users which returns 10 user objects in this format:</p>

<div class="language-json highlighter-rouge"><pre class="highlight"><code><span class="w">  </span><span class="p">{</span><span class="w">
    </span><span class="nt">"id"</span><span class="p">:</span><span class="w"> </span><span class="mi">1</span><span class="p">,</span><span class="w">
    </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Leanne Graham"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"username"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Bret"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"email"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Sincere@april.biz"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"address"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"street"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Kulas Light"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"suite"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Apt. 556"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"city"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Gwenborough"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"zipcode"</span><span class="p">:</span><span class="w"> </span><span class="s2">"92998-3874"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"geo"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
        </span><span class="nt">"lat"</span><span class="p">:</span><span class="w"> </span><span class="s2">"-37.3159"</span><span class="p">,</span><span class="w">
        </span><span class="nt">"lng"</span><span class="p">:</span><span class="w"> </span><span class="s2">"81.1496"</span><span class="w">
      </span><span class="p">}</span><span class="w">
    </span><span class="p">},</span><span class="w">
    </span><span class="nt">"phone"</span><span class="p">:</span><span class="w"> </span><span class="s2">"1-770-736-8031 x56442"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"website"</span><span class="p">:</span><span class="w"> </span><span class="s2">"hildegard.org"</span><span class="p">,</span><span class="w">
    </span><span class="nt">"company"</span><span class="p">:</span><span class="w"> </span><span class="p">{</span><span class="w">
      </span><span class="nt">"name"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Romaguera-Crona"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"catchPhrase"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Multi-layered client-server neural-net"</span><span class="p">,</span><span class="w">
      </span><span class="nt">"bs"</span><span class="p">:</span><span class="w"> </span><span class="s2">"harness real-time e-markets"</span><span class="w">
    </span><span class="p">}</span><span class="w">
  </span><span class="p">}</span><span class="w">
</span></code></pre>
</div>

<p>The goal will be to convert this to an instance of this matching Swift struct:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">phone</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">website</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">address</span><span class="p">:</span> <span class="kt">Address</span>
    <span class="k">let</span> <span class="nv">company</span><span class="p">:</span> <span class="kt">Company</span>

    <span class="kd">struct</span> <span class="kt">Address</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">street</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">suite</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">zipcode</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">geo</span><span class="p">:</span> <span class="kt">Coordinates</span>

        <span class="kd">struct</span> <span class="kt">Coordinates</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">lat</span><span class="p">:</span> <span class="kt">Double</span>
            <span class="k">let</span> <span class="nv">lng</span><span class="p">:</span> <span class="kt">Double</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="kt">Company</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">catchPhrase</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">bs</span><span class="p">:</span> <span class="kt">String</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The first thing to note is that the Swift struct (and its embedded structs) use multiple different types: Int, String, Double, Address, Coordinates, Company. The JSON data only has strings and numbers and even then, some of the numbers are really strings - look at the lat &amp; lng entries. So converting from JSON to aå struct and back again has always been problematic, but lets give it a go using built-in Swift 3 processing with no external libraries.</p>

<h3 id="decoding-in-swift-3">Decoding in Swift 3:</h3>

<p>You can insert this into a playground or <a href="https://github.com/trozware/json">download my playground</a> and check out the Swift 3 JSON page:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="k">let</span> <span class="nv">sampleDataAddress</span> <span class="o">=</span> <span class="s">"https://jsonplaceholder.typicode.com/users"</span>
<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">sampleDataAddress</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>

<span class="kd">struct</span> <span class="kt">User</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">phone</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">website</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">address</span><span class="p">:</span> <span class="kt">Address</span>
    <span class="k">let</span> <span class="nv">company</span><span class="p">:</span> <span class="kt">Company</span>

    <span class="nf">init</span><span class="p">?(</span><span class="nv">dict</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
        <span class="k">guard</span>
            <span class="k">let</span> <span class="nv">id</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"id"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">Int</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">username</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"username"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">email</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"email"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">phone</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"phone"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">website</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"website"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
            <span class="k">let</span> <span class="nv">addressDict</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"address"</span><span class="p">]</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">],</span>
            <span class="k">let</span> <span class="nv">address</span> <span class="o">=</span> <span class="kt">Address</span><span class="p">(</span><span class="nv">dict</span><span class="p">:</span> <span class="n">addressDict</span><span class="p">),</span>
            <span class="k">let</span> <span class="nv">companyDict</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"company"</span><span class="p">]</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">],</span>
            <span class="k">let</span> <span class="nv">company</span> <span class="o">=</span> <span class="kt">Company</span><span class="p">(</span><span class="nv">dict</span><span class="p">:</span> <span class="n">companyDict</span><span class="p">)</span>
            <span class="k">else</span> <span class="p">{</span>
                <span class="k">return</span> <span class="kc">nil</span>
        <span class="p">}</span>

        <span class="k">self</span><span class="o">.</span><span class="n">id</span> <span class="o">=</span> <span class="n">id</span>
        <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="k">self</span><span class="o">.</span><span class="n">username</span> <span class="o">=</span> <span class="n">username</span>
        <span class="k">self</span><span class="o">.</span><span class="n">email</span> <span class="o">=</span> <span class="n">email</span>
        <span class="k">self</span><span class="o">.</span><span class="n">phone</span> <span class="o">=</span> <span class="n">phone</span>
        <span class="k">self</span><span class="o">.</span><span class="n">website</span> <span class="o">=</span> <span class="n">website</span>
        <span class="k">self</span><span class="o">.</span><span class="n">address</span> <span class="o">=</span> <span class="n">address</span>
        <span class="k">self</span><span class="o">.</span><span class="n">company</span> <span class="o">=</span> <span class="n">company</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="kt">Address</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">street</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">suite</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">zipcode</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">geo</span><span class="p">:</span> <span class="kt">Coordinates</span>

        <span class="nf">init</span><span class="p">?(</span><span class="nv">dict</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">guard</span>
                <span class="k">let</span> <span class="nv">street</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"street"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">suite</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"suite"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">city</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"city"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">zipcode</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"zipcode"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">geoDict</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"geo"</span><span class="p">]</span> <span class="k">as?</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">],</span>
                <span class="k">let</span> <span class="nv">geo</span> <span class="o">=</span> <span class="kt">Coordinates</span><span class="p">(</span><span class="nv">dict</span><span class="p">:</span> <span class="n">geoDict</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>

            <span class="k">self</span><span class="o">.</span><span class="n">street</span> <span class="o">=</span> <span class="n">street</span>
            <span class="k">self</span><span class="o">.</span><span class="n">suite</span> <span class="o">=</span> <span class="n">suite</span>
            <span class="k">self</span><span class="o">.</span><span class="n">city</span> <span class="o">=</span> <span class="n">city</span>
            <span class="k">self</span><span class="o">.</span><span class="n">zipcode</span> <span class="o">=</span> <span class="n">zipcode</span>
            <span class="k">self</span><span class="o">.</span><span class="n">geo</span> <span class="o">=</span> <span class="n">geo</span>
        <span class="p">}</span>

        <span class="kd">struct</span> <span class="kt">Coordinates</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">lat</span><span class="p">:</span> <span class="kt">Double</span>
            <span class="k">let</span> <span class="nv">lng</span><span class="p">:</span> <span class="kt">Double</span>

            <span class="nf">init</span><span class="p">?(</span><span class="nv">dict</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
                <span class="k">guard</span>
                    <span class="k">let</span> <span class="nv">latString</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"lat"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                    <span class="k">let</span> <span class="nv">lat</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">latString</span><span class="p">),</span>
                    <span class="k">let</span> <span class="nv">lngString</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"lng"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                    <span class="k">let</span> <span class="nv">lng</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">lngString</span><span class="p">)</span> <span class="k">else</span> <span class="p">{</span>
                        <span class="k">return</span> <span class="kc">nil</span>
                <span class="p">}</span>
                <span class="k">self</span><span class="o">.</span><span class="n">lat</span> <span class="o">=</span> <span class="n">lat</span>
                <span class="k">self</span><span class="o">.</span><span class="n">lng</span> <span class="o">=</span> <span class="n">lng</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="kt">Company</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">catchPhrase</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">bs</span><span class="p">:</span> <span class="kt">String</span>

        <span class="nf">init</span><span class="p">?(</span><span class="nv">dict</span><span class="p">:</span> <span class="p">[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">])</span> <span class="p">{</span>
            <span class="k">guard</span>
                <span class="k">let</span> <span class="nv">name</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"name"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">catchPhrase</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"catchPhrase"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span><span class="p">,</span>
                <span class="k">let</span> <span class="nv">bs</span> <span class="o">=</span> <span class="n">dict</span><span class="p">[</span><span class="s">"bs"</span><span class="p">]</span> <span class="k">as?</span> <span class="kt">String</span> <span class="k">else</span> <span class="p">{</span>
                    <span class="k">return</span> <span class="kc">nil</span>
            <span class="p">}</span>

            <span class="k">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
            <span class="k">self</span><span class="o">.</span><span class="n">catchPhrase</span> <span class="o">=</span> <span class="n">catchPhrase</span>
            <span class="k">self</span><span class="o">.</span><span class="n">bs</span> <span class="o">=</span> <span class="n">bs</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">json</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="kt">JSONSerialization</span><span class="o">.</span><span class="nf">jsonObject</span><span class="p">(</span><span class="nv">with</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">,</span> <span class="nv">options</span><span class="p">:</span> <span class="p">[])</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">jsonArray</span> <span class="o">=</span> <span class="n">json</span> <span class="k">as?</span> <span class="p">[[</span><span class="kt">String</span><span class="p">:</span> <span class="kt">Any</span><span class="p">]]</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">users</span> <span class="o">=</span> <span class="n">jsonArray</span><span class="o">.</span><span class="n">flatMap</span> <span class="p">{</span>
            <span class="kt">User</span><span class="p">(</span><span class="nv">dict</span><span class="p">:</span> <span class="nv">$0</span><span class="p">)</span>
        <span class="p">}</span>
        <span class="n">users</span><span class="o">.</span><span class="n">count</span>
        <span class="nf">dump</span><span class="p">(</span><span class="n">users</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>I don’t actually expect you to go through all this code in detail, but I included it here to make it obvious how verbose this method is.</p>

<p>The first 3 lines get the data, and I have force-unwrapped the URL and the Data which I would not do in a  production app but which is OK while testing in a playground. Then there is a declaration of the Users struct with all its sub structs. Each one has a failable init that tries to parse the JSON dictionary and returns nil if the data doesn’t match, by way of a lengthy set of guard statements. The basic layout of each struct is the same but it is very verbose. And as an extra step, the lat and lng properties need to be converted from Strings to Doubles.</p>

<p>I have to confess that it took quite come time to get this right … lots of guard statements to check that the data can be converted to the required types which meant that any typos produced an empty array. The sub-structs have to be extracted from the JSON as Dictionaries and then initialised by themselves.</p>

<h3 id="decoding-in-swift-4">Decoding in Swift 4:</h3>

<p>So this works, and I get an array of Users objects. But it isn’t pretty and it takes a lot of code to do the processing. So now I am going to move on to doing this in Swift 4. I am using Xcode 9.0 beta 2 (9M137d) so if you have a later version, you may need to adapt to any changes.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">phone</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">website</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">address</span><span class="p">:</span> <span class="kt">Address</span>
    <span class="k">let</span> <span class="nv">company</span><span class="p">:</span> <span class="kt">Company</span>

    <span class="kd">struct</span> <span class="kt">Address</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">street</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">suite</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">zipcode</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">geo</span><span class="p">:</span> <span class="kt">Coordinates</span>

        <span class="kd">struct</span> <span class="kt">Coordinates</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">lat</span><span class="p">:</span> <span class="kt">String</span>
            <span class="k">let</span> <span class="nv">lng</span><span class="p">:</span> <span class="kt">String</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="kt">Company</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">catchPhrase</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">bs</span><span class="p">:</span> <span class="kt">String</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">users</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Array</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;.</span><span class="k">self</span><span class="p">,</span>
                                    <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
</code></pre>
</div>

<p>Ignoring the complexities of converting latitude and longitude to Doubles, I get vastly simpler code. I declare all the structs as conforming to the <code class="highlighter-rouge">Codable</code> protocol and then I can remove all the init methods and just let <code class="highlighter-rouge">JSONDecoder</code> do its magic. I just have to tell it what data type to expect - in this case an Array of Users.  I don’t have to worry about the initial conversion of the JSON data  to a Dictionary or looping through the elements using flatMap.</p>

<h4 id="changing-data-types">Changing data types:</h4>

<p>The  lat &amp; lng coordinates are stored in the JSON as Strings, but need to be converted to Doubles for the Swift struct.</p>

<p>This requires a custom init method for the Coordinates struct to do the conversion from String to Double.</p>

<p>So here is the complete code for Swift 4 - again, if you don’t want to create your own playground, you can <a href="https://github.com/trozware/json">use mine</a>, this time looking at the Swift 4 JSON page:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="k">let</span> <span class="nv">sampleDataAddress</span> <span class="o">=</span> <span class="s">"https://jsonplaceholder.typicode.com/users"</span>
<span class="k">let</span> <span class="nv">url</span> <span class="o">=</span> <span class="kt">URL</span><span class="p">(</span><span class="nv">string</span><span class="p">:</span> <span class="n">sampleDataAddress</span><span class="p">)</span><span class="o">!</span>
<span class="k">let</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="k">try!</span> <span class="kt">Data</span><span class="p">(</span><span class="nv">contentsOf</span><span class="p">:</span> <span class="n">url</span><span class="p">)</span>

<span class="kd">struct</span> <span class="kt">User</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">id</span><span class="p">:</span> <span class="kt">Int</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">username</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">email</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">phone</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">website</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">address</span><span class="p">:</span> <span class="kt">Address</span>
    <span class="k">let</span> <span class="nv">company</span><span class="p">:</span> <span class="kt">Company</span>

    <span class="kd">struct</span> <span class="kt">Address</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">street</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">suite</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">city</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">zipcode</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">geo</span><span class="p">:</span> <span class="kt">Coordinates</span>

        <span class="kd">struct</span> <span class="kt">Coordinates</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
            <span class="k">let</span> <span class="nv">lat</span><span class="p">:</span> <span class="kt">Double</span>
            <span class="k">let</span> <span class="nv">lng</span><span class="p">:</span> <span class="kt">Double</span>

            <span class="nf">init</span><span class="p">(</span><span class="n">from</span> <span class="nv">decoder</span><span class="p">:</span> <span class="kt">Decoder</span><span class="p">)</span> <span class="k">throws</span> <span class="p">{</span>
                <span class="k">let</span> <span class="nv">values</span> <span class="o">=</span> <span class="k">try</span> <span class="n">decoder</span><span class="o">.</span><span class="nf">container</span><span class="p">(</span><span class="nv">keyedBy</span><span class="p">:</span> <span class="kt">CodingKeys</span><span class="o">.</span><span class="k">self</span><span class="p">)</span>
                <span class="k">let</span> <span class="nv">latString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">values</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">lat</span><span class="p">)</span>
                <span class="k">let</span> <span class="nv">lngString</span> <span class="o">=</span> <span class="k">try</span> <span class="n">values</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">String</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">forKey</span><span class="p">:</span> <span class="o">.</span><span class="n">lng</span><span class="p">)</span>
                <span class="n">lat</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">latString</span><span class="p">)</span> <span class="p">??</span> <span class="mi">0</span>
                <span class="n">lng</span> <span class="o">=</span> <span class="kt">Double</span><span class="p">(</span><span class="n">lngString</span><span class="p">)</span> <span class="p">??</span> <span class="mi">0</span>
            <span class="p">}</span>
        <span class="p">}</span>
    <span class="p">}</span>

    <span class="kd">struct</span> <span class="kt">Company</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
        <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">catchPhrase</span><span class="p">:</span> <span class="kt">String</span>
        <span class="k">let</span> <span class="nv">bs</span><span class="p">:</span> <span class="kt">String</span>
    <span class="p">}</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">users</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Array</span><span class="o">&lt;</span><span class="kt">User</span><span class="o">&gt;.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>

<span class="n">users</span><span class="p">?</span><span class="o">.</span><span class="n">count</span>
<span class="nf">dump</span><span class="p">(</span><span class="n">users</span><span class="p">?</span><span class="o">.</span><span class="n">first</span><span class="p">)</span>
</code></pre>
</div>

<p>For comparative purposes, I counted the lines of code in each, removing the common boiler plate of the top of each and the two lines for displaying the results in the playground. I also removed the blank lines which I always use a lot in my code for readability but which are not relevant when comparing code efficiency:</p>

<table>
  <thead>
    <tr>
      <th>Version</th>
      <th style="text-align: right">Lines</th>
      <th style="text-align: right">Lines if lat &amp; lng are Strings</th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td>Swift 3</td>
      <td style="text-align: right">95</td>
      <td style="text-align: right">93</td>
    </tr>
    <tr>
      <td>Swift 4</td>
      <td style="text-align: right">35</td>
      <td style="text-align: right">28</td>
    </tr>
  </tbody>
</table>

<h3 id="encoding">Encoding:</h3>

<p>Encoding back to JSON is very similar. In the Swift 3 version, I would have written a method for each struct that created a Dictionary and then used JSONSerialization to convert the Dictionary back to JSON. This is very verbose and tedious to write so I am not going to bother to demonstrate it here.</p>

<p>But in Swift 4, this is even easier than decoding. Add this code to the end of your Swift 4 JSON playground or playground page:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">if</span> <span class="k">let</span> <span class="nv">users</span> <span class="o">=</span> <span class="n">users</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">jsonEncoder</span> <span class="o">=</span> <span class="kt">JSONEncoder</span><span class="p">()</span>
    <span class="n">jsonEncoder</span><span class="o">.</span><span class="n">outputFormatting</span> <span class="o">=</span> <span class="o">.</span><span class="n">prettyPrinted</span>

    <span class="k">if</span> <span class="k">let</span> <span class="nv">backToJson</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jsonEncoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">users</span><span class="p">)</span> <span class="p">{</span>
        <span class="k">if</span> <span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">backToJson</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
            <span class="nf">print</span><span class="p">(</span><span class="n">jsonString</span><span class="p">)</span>
        <span class="p">}</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>The <code class="highlighter-rouge">JSONEncoder</code> returns Data and I have converted that to a String for checking.  I set JSONEncoder’s outputFormatting property to .prettyPrinted get a more readable String.</p>

<p>Notice how the encoded data is not quite the same as I received because the lat &amp; lng properties are now Doubles. In a production app, if I needed to be able to convert back to JSON, I probably would have left them as Strings so as to enable data transfer in both directions. I would add computed properties to the struct to convert these Strings to Doubles as I needed them.</p>

<h3 id="advanced-decoding">Advanced Decoding:</h3>

<p>Now that we have the basics, I want to look at two more features: changing property names and date handling.</p>

<p>In these examples I used exactly the same names for the properties as were used in the JSON. In the Swift 3 version, it would have been easy to change the property names, since the data for each property was being extracted manually. In Swift 4, if you want the decoder to change names, you have to tell it what you want.</p>

<p>Make a new playground or playground page and replace the contents with this - or go to the Swift 4 Extras page on <a href="https://github.com/trozware/json">my playground</a>:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">import</span> <span class="kt">Foundation</span>

<span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="s">"""
{
"</span><span class="n">name1</span><span class="s">": "</span><span class="kt">Jane</span><span class="s">",
"</span><span class="n">name2</span><span class="s">": "</span><span class="kt">Smith</span><span class="s">"
}
"""</span>
<span class="k">let</span> <span class="nv">jsonData</span> <span class="o">=</span> <span class="n">jsonString</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

<span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonDecoder</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">person</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jsonDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Person</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData</span><span class="p">)</span>
<span class="nf">dump</span><span class="p">(</span><span class="n">person</span><span class="p">)</span>
</code></pre>
</div>

<p>This uses the new multi-line literals in Swift 4 to assemble the JSON string which is amazingly useful as it allows quotes to be embedded in the string without having to escape them. As you can see, the JSON property names are not very helpful, so I want to change them in my Person struct. At the moment, <code class="highlighter-rouge">person</code> is nil because I have not given the decoder any clues to help it translate the names. To do that, I have to add a CodingKeys enum to the Person struct and it tells the decoder what names in the JSON match up to what properties in the struct.</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="kd">struct</span> <span class="kt">Person</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">firstName</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">lastName</span><span class="p">:</span> <span class="kt">String</span>

    <span class="kd">enum</span> <span class="kt">CodingKeys</span><span class="p">:</span> <span class="kt">String</span><span class="p">,</span> <span class="kt">CodingKey</span> <span class="p">{</span>
        <span class="k">case</span> <span class="n">firstName</span> <span class="o">=</span> <span class="s">"name1"</span>
        <span class="k">case</span> <span class="n">lastName</span> <span class="o">=</span> <span class="s">"name2"</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<p>And that’s all I have to do. Now the JSON is correctly converted to a Person. As an exercise, use JSONEncoder to get back to JSON from the Person. You will see that the JSON correctly names the elements using “name1” and “name2”.</p>

<p>Next let’s look at dates - add this code to the playground:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">jsonString2</span> <span class="o">=</span> <span class="s">"""
{
"</span><span class="n">name</span><span class="s">": "</span><span class="kt">My</span> <span class="kt">New</span> <span class="kt">Project</span><span class="s">",
"</span><span class="n">created</span><span class="s">": "</span><span class="mi">2017</span><span class="o">-</span><span class="mo">06</span><span class="o">-</span><span class="mi">18</span><span class="kt">T06</span><span class="p">:</span><span class="mi">28</span><span class="p">:</span><span class="mi">25</span><span class="kt">Z</span><span class="s">"
}
"""</span>
<span class="k">let</span> <span class="nv">jsonData2</span> <span class="o">=</span> <span class="n">jsonString2</span><span class="o">.</span><span class="nf">data</span><span class="p">(</span><span class="nv">using</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span><span class="o">!</span>

<span class="kd">struct</span> <span class="kt">Project</span><span class="p">:</span> <span class="kt">Codable</span> <span class="p">{</span>
    <span class="k">let</span> <span class="nv">name</span><span class="p">:</span> <span class="kt">String</span>
    <span class="k">let</span> <span class="nv">created</span><span class="p">:</span> <span class="kt">Date</span>
<span class="p">}</span>

<span class="k">let</span> <span class="nv">jsonDecoder2</span> <span class="o">=</span> <span class="kt">JSONDecoder</span><span class="p">()</span>
<span class="k">let</span> <span class="nv">project</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jsonDecoder2</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Project</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">jsonData2</span><span class="p">)</span>

<span class="nf">dump</span><span class="p">(</span><span class="n">project</span><span class="p">)</span>
</code></pre>
</div>

<p>When this runs, <code class="highlighter-rouge">project</code> is nil because the decoder has no idea how to get from the String “2017-06-18T06:28:25Z” to a Date object. Add this line after creating <code class="highlighter-rouge">jsonDecoder2</code>:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="n">jsonDecoder2</span><span class="o">.</span><span class="n">dateDecodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="n">iso8601</span>
</code></pre>
</div>

<p>Now the date can be converted and an instance of the Project struct will be created.</p>

<p>And to get back to the JSON, converting the Date back to ISO8601 format:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">jsonEncoder</span> <span class="o">=</span> <span class="kt">JSONEncoder</span><span class="p">()</span>
<span class="n">jsonEncoder</span><span class="o">.</span><span class="n">dateEncodingStrategy</span> <span class="o">=</span> <span class="o">.</span><span class="n">iso8601</span>

<span class="k">if</span> <span class="k">let</span> <span class="nv">backToJson</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">jsonEncoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">jsonString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">backToJson</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">jsonString</span><span class="p">)</span>
    <span class="p">}</span>
<span class="p">}</span>
</code></pre>
</div>

<h3 id="property-lists">Property Lists:</h3>

<p>As well as JSONDecoder and JSONEncoder, Swift 4 has introduced PropertyListDecoder and PropertyListEncoder, so let’s take a quick look at that.</p>

<p>Add this to the bottom of the last playground as it uses the Project struct and data:</p>

<div class="language-swift highlighter-rouge"><pre class="highlight"><code><span class="k">let</span> <span class="nv">plistEncoder</span> <span class="o">=</span> <span class="kt">PropertyListEncoder</span><span class="p">()</span>
<span class="n">plistEncoder</span><span class="o">.</span><span class="n">outputFormat</span> <span class="o">=</span> <span class="o">.</span><span class="n">xml</span>
<span class="k">if</span> <span class="k">let</span> <span class="nv">plist</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">plistEncoder</span><span class="o">.</span><span class="nf">encode</span><span class="p">(</span><span class="n">project</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">if</span> <span class="k">let</span> <span class="nv">plistString</span> <span class="o">=</span> <span class="kt">String</span><span class="p">(</span><span class="nv">data</span><span class="p">:</span> <span class="n">plist</span><span class="p">,</span> <span class="nv">encoding</span><span class="p">:</span> <span class="o">.</span><span class="n">utf8</span><span class="p">)</span> <span class="p">{</span>
        <span class="nf">print</span><span class="p">(</span><span class="n">plistString</span><span class="p">)</span>
    <span class="p">}</span>

    <span class="k">let</span> <span class="nv">plistDecoder</span> <span class="o">=</span> <span class="kt">PropertyListDecoder</span><span class="p">()</span>
    <span class="k">let</span> <span class="nv">project2</span> <span class="o">=</span> <span class="k">try</span><span class="p">?</span> <span class="n">plistDecoder</span><span class="o">.</span><span class="nf">decode</span><span class="p">(</span><span class="kt">Project</span><span class="o">.</span><span class="k">self</span><span class="p">,</span> <span class="nv">from</span><span class="p">:</span> <span class="n">plist</span><span class="p">)</span>

    <span class="nf">dump</span><span class="p">(</span><span class="n">project2</span><span class="p">)</span>
<span class="p">}</span>
</code></pre>
</div>

<p>I don’t see this is being quite as useful as the JSON Encoding &amp; Decoding, but I mention it here for completeness.</p>

<h3 id="codable">Codable:</h3>

<p>In all the Swift 4 examples above, I set the structs to conform to <code class="highlighter-rouge">Codable</code>. Reading Apple’s docs, I see that <code class="highlighter-rouge">Codable</code> is actually a typealias referring to 2 separate protocols:</p>

<pre><code class="language-Swift">typealias Codable = Decodable &amp; Encodable
</code></pre>

<p>If you only need to convert data one way, it will be more efficient to set your struct or class as confirming to only one of these protocols. For example, if you download JSON data from an API but never need to send it back, just conform to Decodable to transform the JSON data into your data structure.</p>

<p>Much more information can be found in the <a href="https://developer.apple.com/documentation/swift/encoding_decoding_and_serialization">Apple documentation</a>.</p>


</article>

<br>
<!-- <a href="/tags/">Tags</a>: swift, json, and learning swift -->
Tags: 

    <a href="/tags/#swift">swift</a>&nbsp;&nbsp;

    <a href="/tags/#json">json</a>&nbsp;&nbsp;

    <a href="/tags/#learning swift">learning swift</a>&nbsp;&nbsp;

<hr>






  <div id="disqus_thread"></div>
  <script type="text/javascript">
    var disqus_shortname  = 'trozware';
    var disqus_identifier = '/2017/06/json-parsing-in-swift-4';
    var disqus_title      = 'JSON Parsing in Swift 4';

    (function() {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    })();
  </script>
  <noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>






      </div>
    </div>
  </div>

  <footer class="center">
  <div class="measure">
    <small>
      Theme crafted with &lt;3 by <a href="http://johnotander.com">John Otander</a> (<a href="https://twitter.com/4lpine">@4lpine</a>).<br>
      &lt;/&gt; available on <a href="https://github.com/johnotander/pixyll">Github</a>.
    </small>
  </div>
</footer>


<script>
(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
(i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
})(window,document,'script','//www.google-analytics.com/analytics.js','ga');

ga('create', 'UA-5511808-2', 'auto');
ga('send', 'pageview');

</script>


</body>
</html>
